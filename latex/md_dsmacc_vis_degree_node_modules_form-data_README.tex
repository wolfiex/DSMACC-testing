A library to create readable {\ttfamily \char`\"{}multipart/form-\/data\char`\"{}} streams. Can be used to submit forms and file uploads to other web applications.

The A\+PI of this library is inspired by the \href{http://dev.w3.org/2006/webapi/XMLHttpRequest-2/Overview.html#the-formdata-interface}{\tt X\+M\+L\+Http\+Request-\/2 Form\+Data Interface}.

\href{https://travis-ci.org/form-data/form-data}{\tt } \href{https://travis-ci.org/form-data/form-data}{\tt } \href{https://ci.appveyor.com/project/alexindigo/form-data}{\tt }

\href{https://coveralls.io/github/form-data/form-data?branch=master}{\tt } \href{https://david-dm.org/form-data/form-data}{\tt } \href{https://www.bithound.io/github/form-data/form-data}{\tt }

\subsection*{Install}


\begin{DoxyCode}
npm install --save form-data
\end{DoxyCode}


\subsection*{Usage}

In this example we are constructing a form with 3 fields that contain a string, a buffer and a file stream.


\begin{DoxyCode}
var FormData = require('form-data');
var fs = require('fs');

var form = new FormData();
form.append('my\_field', 'my value');
form.append('my\_buffer', new Buffer(10));
form.append('my\_file', fs.createReadStream('/foo/bar.jpg'));
\end{DoxyCode}


Also you can use http-\/response stream\+:


\begin{DoxyCode}
var FormData = require('form-data');
var http = require('http');

var form = new FormData();

http.request('http://nodejs.org/images/logo.png', function(response) \{
  form.append('my\_field', 'my value');
  form.append('my\_buffer', new Buffer(10));
  form.append('my\_logo', response);
\});
\end{DoxyCode}


Or \textquotesingle{}s \href{https://github.com/request/request}{\tt request} stream\+:


\begin{DoxyCode}
var FormData = require('form-data');
var request = require('request');

var form = new FormData();

form.append('my\_field', 'my value');
form.append('my\_buffer', new Buffer(10));
form.append('my\_logo', request('http://nodejs.org/images/logo.png'));
\end{DoxyCode}


In order to submit this form to a web application, call {\ttfamily submit(url, \mbox{[}callback\mbox{]})} method\+:


\begin{DoxyCode}
form.submit('http://example.org/', function(err, res) \{
  // res â€“ response object (http.IncomingMessage)  //
  res.resume();
\});
\end{DoxyCode}


For more advanced request manipulations {\ttfamily submit()} method returns {\ttfamily http.\+Client\+Request} object, or you can choose from one of the alternative submission methods.

\subsubsection*{Custom options}

You can provide custom options, such as {\ttfamily max\+Data\+Size}\+:


\begin{DoxyCode}
var FormData = require('form-data');

var form = new FormData(\{ maxDataSize: 20971520 \});
form.append('my\_field', 'my value');
form.append('my\_buffer', /* something big */);
\end{DoxyCode}


List of available options could be found in \href{https://github.com/felixge/node-combined-stream/blob/master/lib/combined_stream.js#L7-L15}{\tt combined-\/stream}

\subsubsection*{Alternative submission methods}

You can use node\textquotesingle{}s http client interface\+:


\begin{DoxyCode}
var http = require('http');

var request = http.request(\{
  method: 'post',
  host: 'example.org',
  path: '/upload',
  headers: form.getHeaders()
\});

form.pipe(request);

request.on('response', function(res) \{
  console.log(res.statusCode);
\});
\end{DoxyCode}


Or if you would prefer the `\textquotesingle{}Content-\/\+Length'\`{} header to be set for you\+:


\begin{DoxyCode}
form.submit('example.org/upload', function(err, res) \{
  console.log(res.statusCode);
\});
\end{DoxyCode}


To use custom headers and pre-\/known length in parts\+:


\begin{DoxyCode}
var CRLF = '\(\backslash\)r\(\backslash\)n';
var form = new FormData();

var options = \{
  header: CRLF + '--' + form.getBoundary() + CRLF + 'X-Custom-Header: 123' + CRLF + CRLF,
  knownLength: 1
\};

form.append('my\_buffer', buffer, options);

form.submit('http://example.com/', function(err, res) \{
  if (err) throw err;
  console.log('Done');
\});
\end{DoxyCode}


Form-\/\+Data can recognize and fetch all the required information from common types of streams ({\ttfamily fs.\+read\+Stream}, {\ttfamily http.\+response} and {\ttfamily mikeal\textquotesingle{}s request}), for some other types of streams you\textquotesingle{}d need to provide \char`\"{}file\char`\"{}-\/related information manually\+:


\begin{DoxyCode}
someModule.stream(function(err, stdout, stderr) \{
  if (err) throw err;

  var form = new FormData();

  form.append('file', stdout, \{
    filename: 'unicycle.jpg', // ... or:
    filepath: 'photos/toys/unicycle.jpg',
    contentType: 'image/jpeg',
    knownLength: 19806
  \});

  form.submit('http://example.com/', function(err, res) \{
    if (err) throw err;
    console.log('Done');
  \});
\});
\end{DoxyCode}


The {\ttfamily filepath} property overrides {\ttfamily filename} and may contain a relative path. This is typically used when uploading \href{https://wicg.github.io/entries-api/#dom-htmlinputelement-webkitdirectory}{\tt multiple files from a directory}.

For edge cases, like P\+O\+ST request to U\+RL with query string or to pass H\+T\+TP auth credentials, object can be passed to {\ttfamily form.\+submit()} as first parameter\+:


\begin{DoxyCode}
form.submit(\{
  host: 'example.com',
  path: '/probably.php?extra=params',
  auth: 'username:password'
\}, function(err, res) \{
  console.log(res.statusCode);
\});
\end{DoxyCode}


In case you need to also send custom H\+T\+TP headers with the P\+O\+ST request, you can use the {\ttfamily headers} key in first parameter of {\ttfamily form.\+submit()}\+:


\begin{DoxyCode}
form.submit(\{
  host: 'example.com',
  path: '/surelynot.php',
  headers: \{'x-test-header': 'test-header-value'\}
\}, function(err, res) \{
  console.log(res.statusCode);
\});
\end{DoxyCode}


\subsubsection*{Integration with other libraries}

\paragraph*{Request}

Form submission using \href{https://github.com/request/request}{\tt request}\+:


\begin{DoxyCode}
var formData = \{
  my\_field: 'my\_value',
  my\_file: fs.createReadStream(\_\_dirname + '/unicycle.jpg'),
\};

request.post(\{url:'http://service.com/upload', formData: formData\}, function(err, httpResponse, body) \{
  if (err) \{
    return console.error('upload failed:', err);
  \}
  console.log('Upload successful!  Server responded with:', body);
\});
\end{DoxyCode}


For more details see \href{https://github.com/request/request#multipartform-data-multipart-form-uploads}{\tt request readme}.

\paragraph*{node-\/fetch}

You can also submit a form using \href{https://github.com/bitinn/node-fetch}{\tt node-\/fetch}\+:


\begin{DoxyCode}
var form = new FormData();

form.append('a', 1);

fetch('http://example.com', \{ method: 'POST', body: form \})
    .then(function(res) \{
        return res.json();
    \}).then(function(json) \{
        console.log(json);
    \});
\end{DoxyCode}


\subsection*{Notes}


\begin{DoxyItemize}
\item {\ttfamily get\+Length\+Sync()} method D\+O\+E\+SN\textquotesingle{}T calculate length for streams, use {\ttfamily known\+Length} options as workaround.
\item Starting version {\ttfamily 2.\+x} Form\+Data has dropped support for {\ttfamily node@0.\+10.\+x}.
\end{DoxyItemize}

\subsection*{License}

Form-\/\+Data is released under the \mbox{[}M\+IT\mbox{]}(License) license. 