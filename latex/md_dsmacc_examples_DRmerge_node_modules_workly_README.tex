
\begin{DoxyItemize}
\item A really simple way to move a stand-\/alone {\bfseries function/class to a worker thread}.
\item Or, {\bfseries expose an object or function in a worker} to the main thread.
\item All calls are made asynchronous. Works great with async/await.
\item Only 1kB gzipped.
\end{DoxyItemize}

\subsection*{Install}

Download the latest from \href{https://github.com/pshihn/workly/tree/master/dist}{\tt dist folder}

or from npm\+: 
\begin{DoxyCode}
npm install --save workly
\end{DoxyCode}


\subsection*{Usage}

Moving a function to a worker is really simple. 
\begin{DoxyCode}
function busyAdd(a, b) \{
  let st = Date.now();
  while (true) \{
    if ((Date.now() - st) > 2000) break;
  \}
  return a + b;
\}

(async () => \{
  let workerAdd = workly.proxy(busyAdd);
  console.log(await workerAdd(23, 16)); // 39
  // the busyAdd is executed in a worker so
  // the UI does not get blocked
\})();
\end{DoxyCode}


Or, in fact a Class


\begin{DoxyCode}
class Adder \{
  constructor() \{
    this.count = 0;
  \}
  add(a, b) \{
    this.count++;
    return a + b;
  \}
\}

(async () => \{
  let WAdder = workly.proxy(Adder);
  let a = await new WAdder(); // instance created/running in worker
  console.log(await a.count); // 0
  console.log(await a.add(23, 16)); // 39
  console.log(await a.count); // 1
\})();
\end{DoxyCode}


\subsubsection*{Custom workers}

The above examples only work when the class/function is not dependent on the containing scope, i.\+e. other libraries or global objects. But, you can create a custom worker.\+js file and move the code in there. In the worker, you can expose your object/function/class using {\itshape workly.\+expose} method.

In this example, the function depends on moment.\+js

{\bfseries worker.\+js} 
\begin{DoxyCode}
importScripts('https://cdn.jsdelivr.net/npm/moment@2.20.1/moment.min.js', '../dist/workly.js');
function friendlyTime(value) \{
  return moment(value).calendar(null, \{
    sameDay: function (now) \{
      if (now - this < 1000 * 60) \{
        return "[Just now]";
      \} else if (now - this < 1000 * 60 * 60) \{
        return "[" + Math.round((now - this) / (1000 * 60)) + " mins ago]";
      \} else \{
        return '[Today at] LT'
      \}
    \}
  \});
\}
workly.expose(friendlyTime);
\end{DoxyCode}
 {\bfseries main.\+js} 
\begin{DoxyCode}
(async () => \{
  let w = workly.proxy("./worker.js");
  let now = Date.now();
  console.log(now);
  console.log(await w(now));
  console.log(await w(now - (24 * 60 * 60 * 1000)));
  console.log(await w(now - (4 * 24 * 60 * 60 * 1000)));
\})();
\end{DoxyCode}


\subsubsection*{Caveats}


\begin{DoxyItemize}
\item If you\textquotesingle{}re not using a custom worker, the function/class being pushed to the worker cannot depend on the containing scope.
\item Since workers do not have access to D\+OM, D\+OM manipulation is not supported.
\item Objects passed into functions are not passed by reference, so if the function in the worker updates the passed in object, it will not affect the object in the main scope.
\end{DoxyItemize}

\subsubsection*{Examples}

See the \href{https://github.com/pshihn/workly/tree/master/examples}{\tt examples folder}

\subsubsection*{License}

\href{https://github.com/pshihn/workly/blob/master/LICENSE}{\tt M\+IT License} (c) \href{https://twitter.com/preetster}{\tt Preet Shihn}

\subsubsection*{You may also be interested in}

\href{https://github.com/pshihn/windtalk}{\tt windtalk} -\/ Simplest way to communicate between windows or iframes. Work with objects/functions defined in another window or iframe. 