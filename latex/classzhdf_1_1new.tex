\hypertarget{classzhdf_1_1new}{}\section{zhdf.\+new Class Reference}
\label{classzhdf_1_1new}\index{zhdf.\+new@{zhdf.\+new}}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
def \mbox{\hyperlink{classzhdf_1_1new_ad4b6f20af51813b7692060ba0ec8acbf}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, h5file, groupid=None, selection=\textquotesingle{}spec, rate, flux, vdot, jacsp, split, prodloss=True, ts=600)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_ac2f471d2887d2c09c702bb16e06dda73}{create\+\_\+posjac}} (self)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_aae8beafb28be4540cbe8b7b90b9915fb}{rm\+\_\+spinup}} (self)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a47eb4a577472f59215c79d2785c2588e}{jratio}} (self, row, column, log=True, all=False)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}{plot}} (self, what, dataframe=\textquotesingle{}spec\textquotesingle{}, vbar=True)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}{loss}} (self, spec)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a7e698f744d38ec1a6a308a21fafa63e5}{prod}} (self, spec)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_aad68ddbb6791ca56a8495047091ccd72}{ropa}} (self, spec, save=False, top=False, time=False, \mbox{\hyperlink{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}{plot}}=True, net=False)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_aa7d832d1f91a699ea51a319ac87e2a84}{lifetime}} (self, spec, timestep=\textquotesingle{}\textquotesingle{}, \mbox{\hyperlink{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}{loss}}=False)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a87ee987ac4b5f4fea8cc03cd78744f81}{dump}} (self, location=\textquotesingle{}./\textquotesingle{}, name=False)
\item 
\mbox{\Hypertarget{classzhdf_1_1new_af986fe148abafe984e302e3b6e419e42}\label{classzhdf_1_1new_af986fe148abafe984e302e3b6e419e42}} 
def {\bfseries \+\_\+\+\_\+init\+\_\+\+\_\+} (self, h5file, groupid=False)
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a3f6a3860bd2fdb82ad44de533a8a053f}\label{classzhdf_1_1new_a3f6a3860bd2fdb82ad44de533a8a053f}} 
def {\bfseries splot} (self, what)
\item 
\mbox{\Hypertarget{classzhdf_1_1new_af2bd6b77614b804f8d160fe126568f6c}\label{classzhdf_1_1new_af2bd6b77614b804f8d160fe126568f6c}} 
def {\bfseries fplot} (self, what)
\item 
\mbox{\Hypertarget{classzhdf_1_1new_ac2da0205a780c8e63238b999c9f8e281}\label{classzhdf_1_1new_ac2da0205a780c8e63238b999c9f8e281}} 
def {\bfseries rplot} (self, what)
\item 
\mbox{\Hypertarget{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}\label{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}} 
def {\bfseries loss} (self, spec)
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a7e698f744d38ec1a6a308a21fafa63e5}\label{classzhdf_1_1new_a7e698f744d38ec1a6a308a21fafa63e5}} 
def {\bfseries prod} (self, spec)
\item 
\mbox{\Hypertarget{classzhdf_1_1new_aad68ddbb6791ca56a8495047091ccd72}\label{classzhdf_1_1new_aad68ddbb6791ca56a8495047091ccd72}} 
def {\bfseries ropa} (self, spec, save=False, top=False, time=False, \mbox{\hyperlink{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}{plot}}=True, net=False)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a43a5465a38adcc9306726e9b7c420e03}{lifetime}} (self, spec, timestep=\textquotesingle{}\textquotesingle{})
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a87ee987ac4b5f4fea8cc03cd78744f81}\label{classzhdf_1_1new_a87ee987ac4b5f4fea8cc03cd78744f81}} 
def {\bfseries dump} (self, location=\textquotesingle{}./\textquotesingle{}, name=False)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_add2078473b549c2c0ec767646c9fb3f5}{\+\_\+\+\_\+init\+\_\+\+\_\+}} (self, h5file, groupid=False, selection=\textquotesingle{}spec, rate, flux, vdot, jacsp, split, prodloss=True, ts=600)
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a9a5792f7565526f92aaa0ec8037a33cb}\label{classzhdf_1_1new_a9a5792f7565526f92aaa0ec8037a33cb}} 
def {\bfseries inposjac} (self, y)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_ac2f471d2887d2c09c702bb16e06dda73}{create\+\_\+posjac}} (self)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_aae8beafb28be4540cbe8b7b90b9915fb}{rm\+\_\+spinup}} (self)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a47eb4a577472f59215c79d2785c2588e}{jratio}} (self, row, column, log=True, all=False)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}{plot}} (self, what, dataframe=\textquotesingle{}spec\textquotesingle{}, vbar=True)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}{loss}} (self, spec)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a7e698f744d38ec1a6a308a21fafa63e5}{prod}} (self, spec)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_aad68ddbb6791ca56a8495047091ccd72}{ropa}} (self, spec, save=False, top=False, time=False, \mbox{\hyperlink{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}{plot}}=True, net=False)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_aa7d832d1f91a699ea51a319ac87e2a84}{lifetime}} (self, spec, timestep=\textquotesingle{}\textquotesingle{}, \mbox{\hyperlink{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}{loss}}=False)
\item 
def \mbox{\hyperlink{classzhdf_1_1new_a87ee987ac4b5f4fea8cc03cd78744f81}{dump}} (self, location=\textquotesingle{}./\textquotesingle{}, name=False)
\end{DoxyCompactItemize}
\subsection*{Public Attributes}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_af5fb3401e7ae6469d4b77595f17f9e89}\label{classzhdf_1_1new_af5fb3401e7ae6469d4b77595f17f9e89}} 
{\bfseries origin}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_afd582b8de7a97241f75a3781f884ebdd}\label{classzhdf_1_1new_afd582b8de7a97241f75a3781f884ebdd}} 
{\bfseries selection}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a999695b31a18e0dbe71c3ef81133ae0f}\label{classzhdf_1_1new_a999695b31a18e0dbe71c3ef81133ae0f}} 
{\bfseries groups}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_afbc68871594d3bd0b5fbf99770af7af0}\label{classzhdf_1_1new_afbc68871594d3bd0b5fbf99770af7af0}} 
{\bfseries groupkeys}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_aef422cae224147b9f501e41fcf6b61dc}\label{classzhdf_1_1new_aef422cae224147b9f501e41fcf6b61dc}} 
{\bfseries flux}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_ab56dbd068e81bae247c19b2c88424d9d}\label{classzhdf_1_1new_ab56dbd068e81bae247c19b2c88424d9d}} 
{\bfseries groupname}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a491df1ba16cdaccd414136e561e6fecc}\label{classzhdf_1_1new_a491df1ba16cdaccd414136e561e6fecc}} 
{\bfseries wall}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a3948dc124db860c652a20782af8c4f11}\label{classzhdf_1_1new_a3948dc124db860c652a20782af8c4f11}} 
{\bfseries timesteps}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_ad9a6af912ee4603a111b1271bd28f743}\label{classzhdf_1_1new_ad9a6af912ee4603a111b1271bd28f743}} 
{\bfseries ts}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a1d060e8d5c3c1433243129886a83df33}\label{classzhdf_1_1new_a1d060e8d5c3c1433243129886a83df33}} 
{\bfseries spinup}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a767638c9de5a2626b2f5a3f8d7a2ea54}\label{classzhdf_1_1new_a767638c9de5a2626b2f5a3f8d7a2ea54}} 
{\bfseries M}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a77683ef695ed2d44adf87c5cd23ecb0f}\label{classzhdf_1_1new_a77683ef695ed2d44adf87c5cd23ecb0f}} 
{\bfseries spec}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a777df7aa8eec6dc13752cacc15bec1c4}\label{classzhdf_1_1new_a777df7aa8eec6dc13752cacc15bec1c4}} 
{\bfseries rate}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_aacec4c0697555545ba32e142e5df5c73}\label{classzhdf_1_1new_aacec4c0697555545ba32e142e5df5c73}} 
{\bfseries vdot}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a7ff39337cb76e8aa5ce05453134814df}\label{classzhdf_1_1new_a7ff39337cb76e8aa5ce05453134814df}} 
{\bfseries jacsp}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_a1bdfa1a8e76c34842aa672b5c97b879b}\label{classzhdf_1_1new_a1bdfa1a8e76c34842aa672b5c97b879b}} 
{\bfseries products}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_ab1cec7707802bcd75878158ffeb1b725}\label{classzhdf_1_1new_ab1cec7707802bcd75878158ffeb1b725}} 
{\bfseries reactants}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_acc0a3341675883ed49907de8fd46cef8}\label{classzhdf_1_1new_acc0a3341675883ed49907de8fd46cef8}} 
{\bfseries prodloss}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_ad2b2165435328b7a27ea6d3b65881e41}\label{classzhdf_1_1new_ad2b2165435328b7a27ea6d3b65881e41}} 
{\bfseries posjac}
\item 
\mbox{\Hypertarget{classzhdf_1_1new_aeb99c2f02882e28bcc7f33a0753040d2}\label{classzhdf_1_1new_aeb99c2f02882e28bcc7f33a0753040d2}} 
{\bfseries s}
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}The DSMACC results group class.
\end{DoxyVerb}
 

\subsection{Constructor \& Destructor Documentation}
\mbox{\Hypertarget{classzhdf_1_1new_ad4b6f20af51813b7692060ba0ec8acbf}\label{classzhdf_1_1new_ad4b6f20af51813b7692060ba0ec8acbf}} 
\index{zhdf\+::new@{zhdf\+::new}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{h5file,  }\item[{}]{groupid = {\ttfamily None},  }\item[{}]{selection = {\ttfamily \textquotesingle{}spec},  }\item[{}]{rate,  }\item[{}]{flux,  }\item[{}]{vdot,  }\item[{}]{jacsp,  }\item[{}]{split,  }\item[{}]{prodloss = {\ttfamily True},  }\item[{}]{ts = {\ttfamily 600} }\end{DoxyParamCaption})}

\begin{DoxyVerb}h5file     - filename
groupid    - select a specific group entry
selections - which data sections to provide in the class
prodloss   - create rxn/ropa dictionaries\end{DoxyVerb}
 
\begin{DoxyCode}
70         prodloss = \textcolor{keyword}{True},ts = 600):
71 
72         \textcolor{stringliteral}{'''}
73 \textcolor{stringliteral}{        h5file     - filename}
74 \textcolor{stringliteral}{        groupid    - select a specific group entry}
75 \textcolor{stringliteral}{        selections - which data sections to provide in the class}
76 \textcolor{stringliteral}{        prodloss   - create rxn/ropa dictionaries}
77 \textcolor{stringliteral}{}
78 \textcolor{stringliteral}{        '''}
79 
80         self.origin = h5file
81         self.selection = selection
82         \textcolor{comment}{#if not os.path.isfile(h5file) : print 'no file found'; return None}
83         \textcolor{comment}{#self.hf = h5py.File( h5file, 'r')}
84         with h5py.File(h5file,\textcolor{stringliteral}{'r') as hf:}
85 \textcolor{stringliteral}{}
86 \textcolor{stringliteral}{}
87 \textcolor{stringliteral}{            groups = list(filter(}\textcolor{keyword}{lambda} x: type(x[1])==h5py.\_hl.group.Group, hf.items()))
88             self.groups = dict([[i[0],j] \textcolor{keywordflow}{for} j,i \textcolor{keywordflow}{in} enumerate(groups)])
89             self.groupkeys = groups[0][1].attrs.keys()
90             self.flux=\textcolor{keyword}{False}
91             
92             \textcolor{keywordflow}{if} type(groupid) == int: 
93                 g = groups[groupid]
94             \textcolor{keywordflow}{elif} type(groupid) == str: 
95                 g = groups[self.groups[groupid]]
96             \textcolor{keywordflow}{else}:
97                 g = groups[0]
98 
99 
100             self.groupname = g[0]
101             g = g[1]
102             self.wall= g.attrs[\textcolor{stringliteral}{'wall'}]
103 
104 
105 
106             \textcolor{keywordflow}{if} \textcolor{keyword}{True}: \textcolor{comment}{# spec MUST always be included...}
107                 \textcolor{comment}{#'spec' in selection:}
108                 shead = g.attrs[\textcolor{stringliteral}{'spechead'}].decode(\textcolor{stringliteral}{"utf-8"}).split(\textcolor{stringliteral}{','})
109                 spec = dd.from\_array(g.get(\textcolor{stringliteral}{'spec'})[:,:],chunksize=50000, columns = shead)
110                 self.timesteps = spec[\textcolor{stringliteral}{'TIME'}].compute().astype(\textcolor{stringliteral}{'M8[s]'})
111 
112 
113 
114                 self.ts= np.array(self.timesteps)
115                 spec[\textcolor{stringliteral}{'TIME'}] = self.timesteps
116                 spec = spec.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
117                 self.spinup= self.ts[int( (spec.SPINUP.max()/ts).compute() ) ]
118                 self.M =  spec.M.mean()
119                 self.spec = spec/self.M
120 
121                 fhead = g.attrs[\textcolor{stringliteral}{'fluxhead'}].decode(\textcolor{stringliteral}{"utf-8"}).split(\textcolor{stringliteral}{','})
122 
123 
124 
125 
126             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'rate'} \textcolor{keywordflow}{in} selection:
127                 rhead = g.attrs[\textcolor{stringliteral}{'ratehead'}].decode(\textcolor{stringliteral}{"utf-8"}).split(\textcolor{stringliteral}{','})
128                 \textcolor{keywordflow}{if} len(rhead) != len(set(rhead)):
129                     \textcolor{keywordflow}{print} (\textcolor{stringliteral}{'Duplicates detected, please parse mecnahisms in future to prevent this'})
130                     rate = pd.DataFrame(g.get(\textcolor{stringliteral}{'rate'})[:,:],columns=rhead)
131                     rate = rate.groupby(rate.columns, axis=1).sum()
132 
133                     rhead = rate.columns
134                     rate = dd.from\_pandas(rate,chunksize=50000)
135                 \textcolor{keywordflow}{else}:
136                     rate = dd.from\_array(g.get(\textcolor{stringliteral}{'rate'})[:,:],chunksize=50000,columns = rhead)
137 
138                 rate[\textcolor{stringliteral}{'TIME'}] = self.timesteps
139                 self.rate = rate.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
140 
141 
142 
143 
144             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'flux'} \textcolor{keywordflow}{in} selection:
145 
146                 \textcolor{keywordflow}{if} len(fhead) != len(set(fhead)):
147                     \textcolor{comment}{#print 'Duplicates detected, please parse mecnahisms in future to prevent this'}
148                     flux = pd.DataFrame(g.get(\textcolor{stringliteral}{'flux'})[:,:],columns=fhead)
149                     flux = flux.groupby(flux.columns, axis=1).sum()
150 
151                     fhead = flux.columns
152                     flux = dd.from\_pandas(flux,chunksize=50000)
153                 \textcolor{keywordflow}{else}:
154                     flux = dd.from\_array(g.get(\textcolor{stringliteral}{'flux'})[:,:],chunksize=50000,columns = fhead)
155                 flux[\textcolor{stringliteral}{'TIME'}] = self.timesteps
156                 self.flux = flux.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
157 
158 
159             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'vdot'} \textcolor{keywordflow}{in} selection:
160                 vhead = g.attrs[\textcolor{stringliteral}{'vdothead'}].decode(\textcolor{stringliteral}{"utf-8"}).split(\textcolor{stringliteral}{','})
161                 vdot = dd.from\_array(g.get(\textcolor{stringliteral}{'vdot'})[:,:],chunksize=50000, columns = vhead)
162                 \textcolor{comment}{#vdot*=-1 # convert such that -ve values suggest flux leaving the species.}
163                 vdot[\textcolor{stringliteral}{'TIME'}] = self.timesteps
164                 self.vdot = vdot.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
165 
166 
167             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'jacsp'} \textcolor{keywordflow}{in} selection:
168                 jhead = g.attrs[\textcolor{stringliteral}{'jacsphead'}].decode(\textcolor{stringliteral}{"utf-8"}).split(\textcolor{stringliteral}{','})
169                 jacsp = dd.from\_array(g.get(\textcolor{stringliteral}{'jacsp'})[:,:],chunksize=50000, columns = jhead)
170                 jacsp[\textcolor{stringliteral}{'TIME'}] = self.timesteps
171                 self.jacsp=jacsp.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
172 
173 
174             hf.close()
175 
176 
177             \textcolor{keywordflow}{if} prodloss:
178                 fcol = \textcolor{stringliteral}{','}.join(fhead)
179                 self.products = [i.split(\textcolor{stringliteral}{'+'}) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} re.findall(\textcolor{stringliteral}{r'-->([A-z0-9+]*)'},fcol)]
180                 self.reactants = np.array([j.split(\textcolor{stringliteral}{'+'}) \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} re.findall(\textcolor{stringliteral}{r'([A-z0-9+]\{1,60\})-->'},fcol)])
181 
182                 self.prodloss = \{k: \{\textcolor{stringliteral}{'loss'}:[],\textcolor{stringliteral}{'prod'}:[]\} \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} shead\}
183                 
184                 \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(len(self.reactants)):
185                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} self.reactants[idx]:
186                         \textcolor{keywordflow}{try}:self.prodloss[i][\textcolor{stringliteral}{'loss'}].append(idx)
187                         \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
188                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} self.products[idx]:
189                         \textcolor{keywordflow}{try}:self.prodloss[i][\textcolor{stringliteral}{'prod'}].append(idx)
190                         \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
191 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_add2078473b549c2c0ec767646c9fb3f5}\label{classzhdf_1_1new_add2078473b549c2c0ec767646c9fb3f5}} 
\index{zhdf\+::new@{zhdf\+::new}!\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}}
\index{\+\_\+\+\_\+init\+\_\+\+\_\+@{\+\_\+\+\_\+init\+\_\+\+\_\+}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{\+\_\+\+\_\+init\+\_\+\+\_\+()}{\_\_init\_\_()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+\_\+\+\_\+init\+\_\+\+\_\+ (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{h5file,  }\item[{}]{groupid = {\ttfamily False},  }\item[{}]{selection = {\ttfamily \textquotesingle{}spec},  }\item[{}]{rate,  }\item[{}]{flux,  }\item[{}]{vdot,  }\item[{}]{jacsp,  }\item[{}]{split,  }\item[{}]{prodloss = {\ttfamily True},  }\item[{}]{ts = {\ttfamily 600} }\end{DoxyParamCaption})}

\begin{DoxyVerb}h5file     - filename
groupid    - select a specific group entry
selections - which data sections to provide in the class
prodloss   - create rxn/ropa dictionaries\end{DoxyVerb}
 
\begin{DoxyCode}
85         prodloss = \textcolor{keyword}{True},ts = 600):
86 
87         \textcolor{stringliteral}{'''}
88 \textcolor{stringliteral}{        h5file     - filename}
89 \textcolor{stringliteral}{        groupid    - select a specific group entry}
90 \textcolor{stringliteral}{        selections - which data sections to provide in the class}
91 \textcolor{stringliteral}{        prodloss   - create rxn/ropa dictionaries}
92 \textcolor{stringliteral}{}
93 \textcolor{stringliteral}{        '''}
94 
95         self.origin = h5file
96         self.selection = selection
97         \textcolor{comment}{#if not os.path.isfile(h5file) : print 'no file found'; return None}
98         \textcolor{comment}{#self.hf = h5py.File( h5file, 'r')}
99         with h5py.File(h5file,\textcolor{stringliteral}{'r') as hf:}
100 \textcolor{stringliteral}{}
101 \textcolor{stringliteral}{            groups = list(filter(}\textcolor{keyword}{lambda} x: type(x[1])==h5py.\_hl.group.Group, hf.items()))
102             self.groups = dict([[i[0],j] \textcolor{keywordflow}{for} j,i \textcolor{keywordflow}{in} enumerate(groups)])
103             self.groupkeys = groups[0][1].attrs.keys()
104             self.flux=\textcolor{keyword}{False}
105 
106             \textcolor{keywordflow}{if} type(groupid) == int:
107                 g = groups[groupid]
108             \textcolor{keywordflow}{elif} type(groupid) == str:
109                 g = groups[self.groups[groupid]]
110             \textcolor{keywordflow}{else}:
111                 g = groups[0]
112 
113 
114             self.groupname = g[0]
115             g = g[1]
116             self.wall= g.attrs[\textcolor{stringliteral}{'wall'}]
117 
118 
119 
120 
121             \textcolor{keywordflow}{if} \textcolor{keyword}{True}: \textcolor{comment}{# spec MUST always be included...}
122                 \textcolor{comment}{#'spec' in selection:.decode("utf-8")}
123                 shead = g.attrs[\textcolor{stringliteral}{'spechead'}].split(\textcolor{stringliteral}{','})
124                 spec = dd.from\_array(g.get(\textcolor{stringliteral}{'spec'})[:,:],chunksize=50000, columns = shead)
125 
126                 \textcolor{stringliteral}{'''}
127 \textcolor{stringliteral}{}
128 \textcolor{stringliteral}{                '''}
129 
130                 self.timesteps = spec[\textcolor{stringliteral}{'TIME'}].compute().astype(\textcolor{stringliteral}{'M8[s]'})
131 
132                 self.s = spec
133                 \textcolor{comment}{#return None}
134 
135 
136 
137                 self.ts= np.array(self.timesteps)
138 
139                 spec[\textcolor{stringliteral}{'TIME'}] = self.timesteps
140                 spec = spec.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
141 
142                 \textcolor{keywordflow}{try}:self.spinup = self.ts[int( (spec.SPINUP.max()/ts).compute() ) ]
143                 \textcolor{keywordflow}{except} IndexError: self.spinup = self.ts[-1]
144                 self.M =  spec.M.mean()
145                 self.spec = spec/self.M
146 
147                 fhead = g.attrs[\textcolor{stringliteral}{'fluxhead'}].split(\textcolor{stringliteral}{','})
148 
149 
150 
151 
152             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'rate'} \textcolor{keywordflow}{in} selection:
153                 rhead = g.attrs[\textcolor{stringliteral}{'ratehead'}].split(\textcolor{stringliteral}{','})
154                 \textcolor{keywordflow}{if} len(rhead) != len(set(rhead)):
155                     \textcolor{keywordflow}{print} (\textcolor{stringliteral}{'Duplicates detected, please parse mecnahisms in future to prevent this'})
156                     rate = pd.DataFrame(g.get(\textcolor{stringliteral}{'rate'})[:,:],columns=rhead)
157                     rate = rate.groupby(rate.columns, axis=1).sum()
158 
159                     rhead = rate.columns
160                     rate = dd.from\_pandas(rate,chunksize=50000)
161                 \textcolor{keywordflow}{else}:
162                     rate = dd.from\_array(g.get(\textcolor{stringliteral}{'rate'})[:,:],chunksize=50000,columns = rhead)
163 
164                 rate[\textcolor{stringliteral}{'TIME'}] = self.timesteps
165                 self.rate = rate.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
166 
167 
168 
169 
170             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'flux'} \textcolor{keywordflow}{in} selection:
171 
172                 \textcolor{keywordflow}{if} len(fhead) != len(set(fhead)):
173                     \textcolor{comment}{#print 'Duplicates detected, please parse mecnahisms in future to prevent this'}
174                     flux = pd.DataFrame(g.get(\textcolor{stringliteral}{'flux'})[:,:],columns=fhead)
175                     flux = flux.groupby(flux.columns, axis=1).sum()
176 
177                     fhead = flux.columns
178                     flux = dd.from\_pandas(flux,chunksize=50000)
179                 \textcolor{keywordflow}{else}:
180                     flux = dd.from\_array(g.get(\textcolor{stringliteral}{'flux'})[:,:],chunksize=50000,columns = fhead)
181                 flux[\textcolor{stringliteral}{'TIME'}] = self.timesteps
182                 self.flux = flux.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
183 
184 
185             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'vdot'} \textcolor{keywordflow}{in} selection:
186                 vhead = g.attrs[\textcolor{stringliteral}{'vdothead'}].split(\textcolor{stringliteral}{','})
187                 vdot = dd.from\_array(g.get(\textcolor{stringliteral}{'vdot'})[:,:],chunksize=50000, columns = vhead)
188                 \textcolor{comment}{#vdot*=-1 # convert such that -ve values suggest flux leaving the species.}
189                 vdot[\textcolor{stringliteral}{'TIME'}] = self.timesteps
190                 self.vdot = vdot.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
191 
192 
193             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'jacsp'} \textcolor{keywordflow}{in} selection:
194                 jhead = g.attrs[\textcolor{stringliteral}{'jacsphead'}].split(\textcolor{stringliteral}{','})
195                 jacsp = dd.from\_array(g.get(\textcolor{stringliteral}{'jacsp'})[:,:],chunksize=50000, columns = jhead)
196                 jacsp[\textcolor{stringliteral}{'TIME'}] = self.timesteps
197                 self.jacsp=jacsp.set\_index(\textcolor{stringliteral}{'TIME'}, sorted=\textcolor{keyword}{True})
198 
199 
200             hf.close()
201 
202 
203             \textcolor{keywordflow}{if} prodloss:
204                 fcol = \textcolor{stringliteral}{','}.join(fhead)
205                 self.products = [i.split(\textcolor{stringliteral}{'+'}) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} re.findall(\textcolor{stringliteral}{r'-->([A-z0-9+]*)'},fcol)]
206                 self.reactants = np.array([j.split(\textcolor{stringliteral}{'+'}) \textcolor{keywordflow}{for} j \textcolor{keywordflow}{in} re.findall(\textcolor{stringliteral}{r'([A-z0-9+]\{1,60\})-->'},fcol)])
207 
208                 self.prodloss = \{k: \{\textcolor{stringliteral}{'loss'}:[],\textcolor{stringliteral}{'prod'}:[]\} \textcolor{keywordflow}{for} k \textcolor{keywordflow}{in} shead\}
209                 
210                 \textcolor{keywordflow}{for} idx \textcolor{keywordflow}{in} range(len(self.reactants)):
211                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} self.reactants[idx]:
212                         \textcolor{keywordflow}{try}:self.prodloss[i][\textcolor{stringliteral}{'loss'}].append(idx)
213                         \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
214                     \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} self.products[idx]:
215                         \textcolor{keywordflow}{try}:self.prodloss[i][\textcolor{stringliteral}{'prod'}].append(idx)
216                         \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
217 
218 
219 \end{DoxyCode}


\subsection{Member Function Documentation}
\mbox{\Hypertarget{classzhdf_1_1new_ac2f471d2887d2c09c702bb16e06dda73}\label{classzhdf_1_1new_ac2f471d2887d2c09c702bb16e06dda73}} 
\index{zhdf\+::new@{zhdf\+::new}!create\+\_\+posjac@{create\+\_\+posjac}}
\index{create\+\_\+posjac@{create\+\_\+posjac}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{create\+\_\+posjac()}{create\_posjac()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+create\+\_\+posjac (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Replace our sparse jacobian with a positive variation (negative links are reversed)
Self reactions are removed and non existant species are removed.
\end{DoxyVerb}
 
\begin{DoxyCode}
192     \textcolor{keyword}{def }create\_posjac(self):
193         \textcolor{stringliteral}{'''}
194 \textcolor{stringliteral}{        Replace our sparse jacobian with a positive variation (negative links are reversed)}
195 \textcolor{stringliteral}{        Self reactions are removed and non existant species are removed.}
196 \textcolor{stringliteral}{        '''}
197         \textcolor{keywordflow}{print} (\textcolor{stringliteral}{'computing the posjac array'})
198 
199         \textcolor{keywordflow}{try}:
200             \textcolor{keywordflow}{return} self.posjac
201         \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
202 
203         \textcolor{comment}{#remove no existant species}
204         \textcolor{comment}{#rm =
       re.compile(r'\(\backslash\)b%s\(\backslash\)b'%'|'.join(set('->'.join(self.jacsp.columns).split('->'))-set(self.spec.columns)))}
205         \textcolor{comment}{#self.posjac = self.jacsp[filter(lambda x: not rm.search(x), self.jacsp.columns)]}
206 
207         \textcolor{comment}{#self reactions and negatives}
208         contains = set(self.jacsp.columns[(self.jacsp<0).sum().astype(bool)])
209         selfself = set((\textcolor{stringliteral}{'%s->%s'}%(i,i) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} self.spec.columns))
210         self.posjac = dd.compute(self.jacsp[list(set(self.jacsp.columns) - selfself)])[0]
211 
212         rev = re.compile(\textcolor{stringliteral}{r'(.+)->(.+)'})
213         \textcolor{comment}{#for each nevative reaction}
214         \textcolor{keywordflow}{for} h \textcolor{keywordflow}{in} contains - selfself:
215             dummy = self.posjac[h]
216             lt = dummy<0
217             mx = np.array(dummy*(-lt))
218             self.posjac[h] = dummy*(dummy>0)
219 
220             hp = rev.sub(\textcolor{stringliteral}{r'\(\backslash\)2->\(\backslash\)1'},h)
221             \textcolor{keywordflow}{try}:self.posjac[hp] = self.posjac[hp] + mx
222             \textcolor{keywordflow}{except}:self.posjac[hp] = mx
223 
224         \textcolor{comment}{#remove emptys}
225         self.posjac = self.posjac[self.posjac.columns[(self.posjac>0).any()]]
226 
227 
228 
229 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_ac2f471d2887d2c09c702bb16e06dda73}\label{classzhdf_1_1new_ac2f471d2887d2c09c702bb16e06dda73}} 
\index{zhdf\+::new@{zhdf\+::new}!create\+\_\+posjac@{create\+\_\+posjac}}
\index{create\+\_\+posjac@{create\+\_\+posjac}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{create\+\_\+posjac()}{create\_posjac()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+create\+\_\+posjac (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Replace our sparse jacobian with a positive variation (negative links are reversed)
Self reactions are removed and non existant species are removed.

Args:
    ignore - list of species to be ignored in posjac array (most commonly inorganics)
\end{DoxyVerb}
 
\begin{DoxyCode}
224     \textcolor{keyword}{def }create\_posjac(self):
225         \textcolor{stringliteral}{'''}
226 \textcolor{stringliteral}{        Replace our sparse jacobian with a positive variation (negative links are reversed)}
227 \textcolor{stringliteral}{        Self reactions are removed and non existant species are removed.}
228 \textcolor{stringliteral}{}
229 \textcolor{stringliteral}{        Args:}
230 \textcolor{stringliteral}{            ignore - list of species to be ignored in posjac array (most commonly inorganics)}
231 \textcolor{stringliteral}{        '''}
232         \textcolor{keywordflow}{print} (\textcolor{stringliteral}{'computing the posjac array'})
233 
234         \textcolor{keywordflow}{try}:
235             self.posjac
236             \textcolor{keywordflow}{print} (\textcolor{stringliteral}{'Posjac already exists, use "del <name>.posjac" to remove it'})
237 
238         \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
239 
240         \textcolor{comment}{#remove no existant species}
241         \textcolor{comment}{#rm =
       re.compile(r'\(\backslash\)b%s\(\backslash\)b'%'|'.join(set('->'.join(self.jacsp.columns).split('->'))-set(self.spec.columns)))}
242         \textcolor{comment}{#self.posjac = self.jacsp[filter(lambda x: not rm.search(x), self.jacsp.columns)]}
243 
244         \textcolor{comment}{#self reactions and negatives}
245 
246 
247         contains = set(self.jacsp.columns)
248         selfself = set((\textcolor{stringliteral}{'%s->%s'}%(i,i) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} self.spec.columns))
249 
250         rxns = list(set(self.jacsp.columns) - selfself)
251 
252         self.posjac = dd.compute(self.jacsp[rxns])[0]
253 
254         rev = re.compile(\textcolor{stringliteral}{r'(.+)->(.+)'})
255         \textcolor{comment}{#for each negative reaction}
256         \textcolor{keywordflow}{for} h \textcolor{keywordflow}{in} rxns:
257             \textcolor{comment}{#our column}
258             dummy = self.posjac[h]
259             \textcolor{comment}{#save static positive values - unchanged}
260             self.posjac[h] = dummy*(dummy>0).astype(float)
261 
262             \textcolor{comment}{#negative (reverse ) values only}
263             lt = dummy<0
264             mx = np.array(dummy*(-lt.astype(float)))
265 
266             \textcolor{comment}{#reverse link}
267             hp = rev.sub(\textcolor{stringliteral}{r'\(\backslash\)2->\(\backslash\)1'},h)
268             \textcolor{keywordflow}{try}:self.posjac[hp] = self.posjac[hp] + mx
269             \textcolor{keywordflow}{except}:self.posjac[hp] = mx
270 
271         \textcolor{comment}{#remove emptys}
272         self.posjac = self.posjac[self.posjac.columns[(self.posjac!=0).sum().astype(bool)]]
273 
274 
275 
276 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a87ee987ac4b5f4fea8cc03cd78744f81}\label{classzhdf_1_1new_a87ee987ac4b5f4fea8cc03cd78744f81}} 
\index{zhdf\+::new@{zhdf\+::new}!dump@{dump}}
\index{dump@{dump}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{dump()}{dump()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+dump (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{location = {\ttfamily \textquotesingle{}./\textquotesingle{}},  }\item[{}]{name = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Save this new DSMACC class as a dill file.
Useful if we need a fast loading dataset for a single run out of many.
\end{DoxyVerb}
 
\begin{DoxyCode}
393     \textcolor{keyword}{def }dump(self,location = './', name = False):
394         \textcolor{stringliteral}{'''}
395 \textcolor{stringliteral}{        Save this new DSMACC class as a dill file.}
396 \textcolor{stringliteral}{        Useful if we need a fast loading dataset for a single run out of many.}
397 \textcolor{stringliteral}{        '''}
398         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} name: name = self.origin.replace(\textcolor{stringliteral}{'.h5'},\textcolor{stringliteral}{''})  + self.groupname+\textcolor{stringliteral}{'.dill'}
399         \textcolor{keyword}{import} dill
400 
401         \textcolor{keywordflow}{try}:self.closehf()
402         \textcolor{keywordflow}{except}: \textcolor{keywordtype}{None}
403         dill.dump(self,open(location+name,\textcolor{stringliteral}{'wb'}))
404         \textcolor{keywordflow}{print} (\textcolor{stringliteral}{'saved'})
405 
406 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a87ee987ac4b5f4fea8cc03cd78744f81}\label{classzhdf_1_1new_a87ee987ac4b5f4fea8cc03cd78744f81}} 
\index{zhdf\+::new@{zhdf\+::new}!dump@{dump}}
\index{dump@{dump}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{dump()}{dump()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+dump (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{location = {\ttfamily \textquotesingle{}./\textquotesingle{}},  }\item[{}]{name = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Save this new DSMACC class as a dill file.
Useful if we need a fast loading dataset for a single run out of many.
\end{DoxyVerb}
 
\begin{DoxyCode}
440     \textcolor{keyword}{def }dump(self,location = './', name = False):
441         \textcolor{stringliteral}{'''}
442 \textcolor{stringliteral}{        Save this new DSMACC class as a dill file.}
443 \textcolor{stringliteral}{        Useful if we need a fast loading dataset for a single run out of many.}
444 \textcolor{stringliteral}{        '''}
445         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} name: name = self.origin.replace(\textcolor{stringliteral}{'.h5'},\textcolor{stringliteral}{''})  + self.groupname+\textcolor{stringliteral}{'.dill'}
446         \textcolor{keyword}{import} dill
447 
448         \textcolor{keywordflow}{try}:self.closehf()
449         \textcolor{keywordflow}{except}: \textcolor{keywordtype}{None}
450         dill.dump(self,open(location+name,\textcolor{stringliteral}{'wb'}))
451         \textcolor{keywordflow}{print} (\textcolor{stringliteral}{'saved'})
452 
453 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a47eb4a577472f59215c79d2785c2588e}\label{classzhdf_1_1new_a47eb4a577472f59215c79d2785c2588e}} 
\index{zhdf\+::new@{zhdf\+::new}!jratio@{jratio}}
\index{jratio@{jratio}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{jratio()}{jratio()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+jratio (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{row,  }\item[{}]{column,  }\item[{}]{log = {\ttfamily True},  }\item[{}]{all = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Find the ratio contribution of a species using the jacobian.
source = column
target = row (produced)

log - takes the natural log
all - returns the complete dataframe for production of target(row)
\end{DoxyVerb}
 
\begin{DoxyCode}
240     \textcolor{keyword}{def }jratio(self,row,column,log = True,all = False):
241         \textcolor{stringliteral}{'''}
242 \textcolor{stringliteral}{        Find the ratio contribution of a species using the jacobian.}
243 \textcolor{stringliteral}{        source = column}
244 \textcolor{stringliteral}{        target = row (produced)}
245 \textcolor{stringliteral}{}
246 \textcolor{stringliteral}{        log - takes the natural log}
247 \textcolor{stringliteral}{        all - returns the complete dataframe for production of target(row)}
248 \textcolor{stringliteral}{        '''}
249         \textcolor{keywordflow}{if} row == column:\textcolor{keywordflow}{return} \textcolor{keyword}{False}
250         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} hasattr(self, \textcolor{stringliteral}{'posjac'}):self.create\_posjac()
251 
252         \textcolor{keyword}{def }inc(x):
253              x = x.split(\textcolor{stringliteral}{'->'})
254              \textcolor{keywordflow}{return} x[1] == row \textcolor{keywordflow}{and} x[0] != row
255 
256         jh = filter(inc, self.posjac.columns )
257         data = self.posjac[jh].astype(float)
258         \textcolor{keywordflow}{if} log:data = np.log(data)
259         \textcolor{keywordflow}{if} all:\textcolor{keywordflow}{return} data
260         by = \textcolor{stringliteral}{'%s->%s'}%(column,row)
261 
262         \textcolor{keywordflow}{try}:\textcolor{keywordflow}{return} data[by].divide(data.sum(axis=1)).replace([np.inf, -np.inf], 0)
263         \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} e:\textcolor{keywordflow}{return} \textcolor{keyword}{False}
264 
265 
266 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a47eb4a577472f59215c79d2785c2588e}\label{classzhdf_1_1new_a47eb4a577472f59215c79d2785c2588e}} 
\index{zhdf\+::new@{zhdf\+::new}!jratio@{jratio}}
\index{jratio@{jratio}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{jratio()}{jratio()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+jratio (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{row,  }\item[{}]{column,  }\item[{}]{log = {\ttfamily True},  }\item[{}]{all = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Find the ratio contribution of a species using the jacobian.
source = column
target = row (produced)

log - takes the natural log
all - returns the complete dataframe for production of target(row)
\end{DoxyVerb}
 
\begin{DoxyCode}
287     \textcolor{keyword}{def }jratio(self,row,column,log = True,all = False):
288         \textcolor{stringliteral}{'''}
289 \textcolor{stringliteral}{        Find the ratio contribution of a species using the jacobian.}
290 \textcolor{stringliteral}{        source = column}
291 \textcolor{stringliteral}{        target = row (produced)}
292 \textcolor{stringliteral}{}
293 \textcolor{stringliteral}{        log - takes the natural log}
294 \textcolor{stringliteral}{        all - returns the complete dataframe for production of target(row)}
295 \textcolor{stringliteral}{        '''}
296         \textcolor{keywordflow}{if} row == column:\textcolor{keywordflow}{return} \textcolor{keyword}{False}
297         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} hasattr(self, \textcolor{stringliteral}{'posjac'}):self.create\_posjac()
298 
299         \textcolor{keyword}{def }inc(x):
300              x = x.split(\textcolor{stringliteral}{'->'})
301              \textcolor{keywordflow}{return} x[1] == row \textcolor{keywordflow}{and} x[0] != row
302 
303         jh = filter(inc, self.posjac.columns )
304         data = self.posjac[jh].astype(float)
305         \textcolor{keywordflow}{if} log:data = np.log(data)
306         \textcolor{keywordflow}{if} all:\textcolor{keywordflow}{return} data
307         by = \textcolor{stringliteral}{'%s->%s'}%(column,row)
308 
309         \textcolor{keywordflow}{try}:\textcolor{keywordflow}{return} data[by].divide(data.sum(axis=1)).replace([np.inf, -np.inf], 0)
310         \textcolor{keywordflow}{except} Exception \textcolor{keyword}{as} e:\textcolor{keywordflow}{return} \textcolor{keyword}{False}
311 
312 
313 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a43a5465a38adcc9306726e9b7c420e03}\label{classzhdf_1_1new_a43a5465a38adcc9306726e9b7c420e03}} 
\index{zhdf\+::new@{zhdf\+::new}!lifetime@{lifetime}}
\index{lifetime@{lifetime}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{lifetime()}{lifetime()}\hspace{0.1cm}{\footnotesize\ttfamily [1/3]}}
{\footnotesize\ttfamily def zhdf.\+new.\+lifetime (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec,  }\item[{}]{timestep = {\ttfamily \textquotesingle{}\textquotesingle{}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}a + b + c > d     @ r1
a         > f + h @ r2

tau_A = 1/(   1/[c][d]r1   + 1/r2      )


timestep: [NoneType=diurnalprofile, Timestring=point, default=return all, str=data]
\end{DoxyVerb}
\begin{DoxyVerb}for prod in self.prod(spec):

    try:
        lifetimev-= self.flux[prod]
    except NameError:
        lifetimev  = -1.*self.flux[prod]\end{DoxyVerb}
 
\begin{DoxyCode}
302     \textcolor{keyword}{def }lifetime(self,spec,timestep=''):
303             \textcolor{stringliteral}{'''}
304 \textcolor{stringliteral}{            a + b + c > d     @ r1}
305 \textcolor{stringliteral}{            a         > f + h @ r2}
306 \textcolor{stringliteral}{}
307 \textcolor{stringliteral}{            tau\_A = 1/(   1/[c][d]r1   + 1/r2      )}
308 \textcolor{stringliteral}{}
309 \textcolor{stringliteral}{}
310 \textcolor{stringliteral}{            timestep: [NoneType=diurnalprofile, Timestring=point, default=return all, str=data]}
311 \textcolor{stringliteral}{            '''}
312             \textcolor{stringliteral}{'''}
313 \textcolor{stringliteral}{            for prod in self.prod(spec):}
314 \textcolor{stringliteral}{}
315 \textcolor{stringliteral}{                            try:}
316 \textcolor{stringliteral}{                                lifetimev-= self.flux[prod]}
317 \textcolor{stringliteral}{                            except NameError:}
318 \textcolor{stringliteral}{                                lifetimev  = -1.*self.flux[prod]}
319 \textcolor{stringliteral}{}
320 \textcolor{stringliteral}{                                '''}
321             \textcolor{keywordflow}{for} loss \textcolor{keywordflow}{in} self.loss(spec):
322 
323                 \textcolor{keywordflow}{try}:
324                     lifetimev+= self.flux[loss]
325                 \textcolor{keywordflow}{except} NameError:
326                     lifetimev  = self.flux[loss]
327             \textcolor{keywordflow}{if} \textcolor{stringliteral}{'lifetimev'} \textcolor{keywordflow}{in} locals() :
328 
329                 tau = lifetimev/self.spec[spec]
330 
331                 timetype = type(timestep).\_\_name\_\_
332 
333                 \textcolor{keywordflow}{if} timetype == \textcolor{stringliteral}{'str'}:
334                     rtn = tau.describe().compute()
335                 \textcolor{keywordflow}{elif} timetype == \textcolor{stringliteral}{'bool'}:
336                     rtn = tau
337                 \textcolor{keywordflow}{elif} timetype == \textcolor{stringliteral}{'pandas.\_libs.tslib.Timestamp'}:
338                     rtn = tau.loc[timestep].compute()[0]
339                 \textcolor{keywordflow}{elif} timetype == \textcolor{stringliteral}{'list'}:
340                     rtn = tau.loc[timestep[0]:timestep[1]].compute()
341                 \textcolor{keywordflow}{else}:
342                     rtn =tau.groupby(tau.index.map\_partitions(\textcolor{keyword}{lambda} x: x.hour)).mean().compute()
343 
344                 \textcolor{keywordflow}{return} rtn
345 
346 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_aa7d832d1f91a699ea51a319ac87e2a84}\label{classzhdf_1_1new_aa7d832d1f91a699ea51a319ac87e2a84}} 
\index{zhdf\+::new@{zhdf\+::new}!lifetime@{lifetime}}
\index{lifetime@{lifetime}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{lifetime()}{lifetime()}\hspace{0.1cm}{\footnotesize\ttfamily [2/3]}}
{\footnotesize\ttfamily def zhdf.\+new.\+lifetime (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec,  }\item[{}]{timestep = {\ttfamily \textquotesingle{}\textquotesingle{}},  }\item[{}]{loss = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}a + b + c > d     @ r1
a         > f + h @ r2

tau_A = 1/(   1/[c][d]r1   + 1/r2      )
tau_A = 1/ (sum of fluxes out)


returns log10 of flux


timestep: [NoneType=diurnalprofile, Timestring=point, default=return all, str=data]
\end{DoxyVerb}
\begin{DoxyVerb}for prod in self.prod(spec):

    try:
        lifetimev-= self.flux[prod]
    except NameError:
        lifetimev  = -1.*self.flux[prod]\end{DoxyVerb}
 
\begin{DoxyCode}
361     \textcolor{keyword}{def }lifetime(self,spec,timestep='',loss=False):
362             \textcolor{stringliteral}{'''}
363 \textcolor{stringliteral}{            a + b + c > d     @ r1}
364 \textcolor{stringliteral}{            a         > f + h @ r2}
365 \textcolor{stringliteral}{}
366 \textcolor{stringliteral}{            tau\_A = 1/(   1/[c][d]r1   + 1/r2      )}
367 \textcolor{stringliteral}{            tau\_A = 1/ (sum of fluxes out)}
368 \textcolor{stringliteral}{}
369 \textcolor{stringliteral}{}
370 \textcolor{stringliteral}{            returns log10 of flux}
371 \textcolor{stringliteral}{}
372 \textcolor{stringliteral}{}
373 \textcolor{stringliteral}{            timestep: [NoneType=diurnalprofile, Timestring=point, default=return all, str=data]}
374 \textcolor{stringliteral}{            '''}
375             \textcolor{stringliteral}{'''}
376 \textcolor{stringliteral}{            for prod in self.prod(spec):}
377 \textcolor{stringliteral}{}
378 \textcolor{stringliteral}{                            try:}
379 \textcolor{stringliteral}{                                lifetimev-= self.flux[prod]}
380 \textcolor{stringliteral}{                            except NameError:}
381 \textcolor{stringliteral}{                                lifetimev  = -1.*self.flux[prod]}
382 \textcolor{stringliteral}{}
383 \textcolor{stringliteral}{                                '''}
384 
385             tau = 1/self.vdot[spec]
386 
387             \textcolor{keywordflow}{if} loss:
388                 tau = tau[tau>0]
389 
390             \textcolor{keywordflow}{return} np.log10(tau)
391 
392 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_aa7d832d1f91a699ea51a319ac87e2a84}\label{classzhdf_1_1new_aa7d832d1f91a699ea51a319ac87e2a84}} 
\index{zhdf\+::new@{zhdf\+::new}!lifetime@{lifetime}}
\index{lifetime@{lifetime}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{lifetime()}{lifetime()}\hspace{0.1cm}{\footnotesize\ttfamily [3/3]}}
{\footnotesize\ttfamily def zhdf.\+new.\+lifetime (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec,  }\item[{}]{timestep = {\ttfamily \textquotesingle{}\textquotesingle{}},  }\item[{}]{loss = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}a + b + c > d     @ r1
a         > f + h @ r2

tau_A = 1/(   1/[c][d]r1   + 1/r2      )
tau_A = 1/ (sum of fluxes out)


returns log10 of flux


timestep: [NoneType=diurnalprofile, Timestring=point, default=return all, str=data]
\end{DoxyVerb}
\begin{DoxyVerb}for prod in self.prod(spec):

    try:
        lifetimev-= self.flux[prod]
    except NameError:
        lifetimev  = -1.*self.flux[prod]\end{DoxyVerb}
 
\begin{DoxyCode}
408     \textcolor{keyword}{def }lifetime(self,spec,timestep='',loss=False):
409             \textcolor{stringliteral}{'''}
410 \textcolor{stringliteral}{            a + b + c > d     @ r1}
411 \textcolor{stringliteral}{            a         > f + h @ r2}
412 \textcolor{stringliteral}{}
413 \textcolor{stringliteral}{            tau\_A = 1/(   1/[c][d]r1   + 1/r2      )}
414 \textcolor{stringliteral}{            tau\_A = 1/ (sum of fluxes out)}
415 \textcolor{stringliteral}{}
416 \textcolor{stringliteral}{}
417 \textcolor{stringliteral}{            returns log10 of flux}
418 \textcolor{stringliteral}{}
419 \textcolor{stringliteral}{}
420 \textcolor{stringliteral}{            timestep: [NoneType=diurnalprofile, Timestring=point, default=return all, str=data]}
421 \textcolor{stringliteral}{            '''}
422             \textcolor{stringliteral}{'''}
423 \textcolor{stringliteral}{            for prod in self.prod(spec):}
424 \textcolor{stringliteral}{}
425 \textcolor{stringliteral}{                            try:}
426 \textcolor{stringliteral}{                                lifetimev-= self.flux[prod]}
427 \textcolor{stringliteral}{                            except NameError:}
428 \textcolor{stringliteral}{                                lifetimev  = -1.*self.flux[prod]}
429 \textcolor{stringliteral}{}
430 \textcolor{stringliteral}{                                '''}
431 
432             tau = 1/self.vdot[spec]
433 
434             \textcolor{keywordflow}{if} loss:
435                 tau = tau[tau>0]
436 
437             \textcolor{keywordflow}{return} np.log10(tau)
438 
439 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}\label{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}} 
\index{zhdf\+::new@{zhdf\+::new}!loss@{loss}}
\index{loss@{loss}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{loss()}{loss()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+loss (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns loss reactions\end{DoxyVerb}
 
\begin{DoxyCode}
282     \textcolor{keyword}{def }loss(self,spec):
283         \textcolor{stringliteral}{'''Returns loss reactions'''}
284         \textcolor{keywordflow}{return} self.flux.columns[self.prodloss[spec][\textcolor{stringliteral}{'loss'}]]
285 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}\label{classzhdf_1_1new_af05896dbaac383f107e46d76287d0ea0}} 
\index{zhdf\+::new@{zhdf\+::new}!loss@{loss}}
\index{loss@{loss}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{loss()}{loss()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+loss (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns loss reactions\end{DoxyVerb}
 
\begin{DoxyCode}
329     \textcolor{keyword}{def }loss(self,spec):
330         \textcolor{stringliteral}{'''Returns loss reactions'''}
331         \textcolor{keywordflow}{return} self.flux.columns[self.prodloss[spec][\textcolor{stringliteral}{'loss'}]]
332 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}\label{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}} 
\index{zhdf\+::new@{zhdf\+::new}!plot@{plot}}
\index{plot@{plot}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{plot()}{plot()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+plot (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{what,  }\item[{}]{dataframe = {\ttfamily \textquotesingle{}spec\textquotesingle{}},  }\item[{}]{vbar = {\ttfamily True} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Fast plotting function
what - species / column header of interest
dataframe - spec, rate, vdot, jacsp, flux (str)
vbar - spinup bar
\end{DoxyVerb}
 
\begin{DoxyCode}
267     \textcolor{keyword}{def }plot (self, what, dataframe = 'spec',vbar=True ):
268         \textcolor{stringliteral}{'''}
269 \textcolor{stringliteral}{        Fast plotting function}
270 \textcolor{stringliteral}{        what - species / column header of interest}
271 \textcolor{stringliteral}{        dataframe - spec, rate, vdot, jacsp, flux (str)}
272 \textcolor{stringliteral}{        vbar - spinup bar}
273 \textcolor{stringliteral}{        '''}
274         \textcolor{keyword}{import} \mbox{\hyperlink{namespacematplotlib_1_1pyplot}{matplotlib.pyplot}} \textcolor{keyword}{as} plt
275         df = pd.DataFrame((getattr (self,dataframe)[what]).compute()).plot()
276         \textcolor{keywordflow}{if} vbar:
277             plt.axvline(x=self.spinup,color=\textcolor{stringliteral}{'grey'}, ls=\textcolor{stringliteral}{'--'})
278         plt.show()
279         \textcolor{keywordflow}{return} df
280 
281 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}\label{classzhdf_1_1new_a9745f192f8c6f7e375a6fada1f44525a}} 
\index{zhdf\+::new@{zhdf\+::new}!plot@{plot}}
\index{plot@{plot}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{plot()}{plot()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+plot (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{what,  }\item[{}]{dataframe = {\ttfamily \textquotesingle{}spec\textquotesingle{}},  }\item[{}]{vbar = {\ttfamily True} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Fast plotting function
what - species / column header of interest
dataframe - spec, rate, vdot, jacsp, flux (str)
vbar - spinup bar
\end{DoxyVerb}
 
\begin{DoxyCode}
314     \textcolor{keyword}{def }plot (self, what, dataframe = 'spec',vbar=True ):
315         \textcolor{stringliteral}{'''}
316 \textcolor{stringliteral}{        Fast plotting function}
317 \textcolor{stringliteral}{        what - species / column header of interest}
318 \textcolor{stringliteral}{        dataframe - spec, rate, vdot, jacsp, flux (str)}
319 \textcolor{stringliteral}{        vbar - spinup bar}
320 \textcolor{stringliteral}{        '''}
321         \textcolor{keyword}{import} \mbox{\hyperlink{namespacematplotlib_1_1pyplot}{matplotlib.pyplot}} \textcolor{keyword}{as} plt
322         df = pd.DataFrame((getattr (self,dataframe)[what]).compute()).plot()
323         \textcolor{keywordflow}{if} vbar:
324             plt.axvline(x=self.spinup,color=\textcolor{stringliteral}{'grey'}, ls=\textcolor{stringliteral}{'--'})
325         plt.show()
326         \textcolor{keywordflow}{return} df
327 
328 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a7e698f744d38ec1a6a308a21fafa63e5}\label{classzhdf_1_1new_a7e698f744d38ec1a6a308a21fafa63e5}} 
\index{zhdf\+::new@{zhdf\+::new}!prod@{prod}}
\index{prod@{prod}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{prod()}{prod()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+prod (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns production reactions\end{DoxyVerb}
 
\begin{DoxyCode}
286     \textcolor{keyword}{def }prod(self,spec):
287         \textcolor{stringliteral}{'''Returns production reactions'''}
288         \textcolor{keywordflow}{return} self.flux.columns[self.prodloss[spec][\textcolor{stringliteral}{'prod'}]]
289 
290 
291 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_a7e698f744d38ec1a6a308a21fafa63e5}\label{classzhdf_1_1new_a7e698f744d38ec1a6a308a21fafa63e5}} 
\index{zhdf\+::new@{zhdf\+::new}!prod@{prod}}
\index{prod@{prod}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{prod()}{prod()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+prod (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec }\end{DoxyParamCaption})}

\begin{DoxyVerb}Returns production reactions\end{DoxyVerb}
 
\begin{DoxyCode}
333     \textcolor{keyword}{def }prod(self,spec):
334         \textcolor{stringliteral}{'''Returns production reactions'''}
335         \textcolor{keywordflow}{return} self.flux.columns[self.prodloss[spec][\textcolor{stringliteral}{'prod'}]]
336 
337 
338 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_aae8beafb28be4540cbe8b7b90b9915fb}\label{classzhdf_1_1new_aae8beafb28be4540cbe8b7b90b9915fb}} 
\index{zhdf\+::new@{zhdf\+::new}!rm\+\_\+spinup@{rm\+\_\+spinup}}
\index{rm\+\_\+spinup@{rm\+\_\+spinup}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{rm\+\_\+spinup()}{rm\_spinup()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+rm\+\_\+spinup (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Remove spinup calculations from arrays
\end{DoxyVerb}
 
\begin{DoxyCode}
230     \textcolor{keyword}{def }rm\_spinup(self):
231         \textcolor{stringliteral}{'''}
232 \textcolor{stringliteral}{        Remove spinup calculations from arrays}
233 \textcolor{stringliteral}{        '''}
234         self.timesteps = self.timesteps[self.timesteps.gt(self.spinup)][2:]
235         self.ts = np.array(self.timesteps)
236         \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} self.selection:
237             setattr(self,d, getattr (self,d).loc[self.ts,:])
238 
239 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_aae8beafb28be4540cbe8b7b90b9915fb}\label{classzhdf_1_1new_aae8beafb28be4540cbe8b7b90b9915fb}} 
\index{zhdf\+::new@{zhdf\+::new}!rm\+\_\+spinup@{rm\+\_\+spinup}}
\index{rm\+\_\+spinup@{rm\+\_\+spinup}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{rm\+\_\+spinup()}{rm\_spinup()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+rm\+\_\+spinup (\begin{DoxyParamCaption}\item[{}]{self }\end{DoxyParamCaption})}

\begin{DoxyVerb}Remove spinup calculations from arrays
\end{DoxyVerb}
 
\begin{DoxyCode}
277     \textcolor{keyword}{def }rm\_spinup(self):
278         \textcolor{stringliteral}{'''}
279 \textcolor{stringliteral}{        Remove spinup calculations from arrays}
280 \textcolor{stringliteral}{        '''}
281         self.timesteps = self.timesteps[self.timesteps.gt(self.spinup)][2:]
282         self.ts = np.array(self.timesteps)
283         \textcolor{keywordflow}{for} d \textcolor{keywordflow}{in} self.selection:
284             setattr(self,d, getattr (self,d).loc[self.ts,:])
285         self.timesteps = self.timesteps.reset\_index()[\textcolor{stringliteral}{'TIME'}]
286 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_aad68ddbb6791ca56a8495047091ccd72}\label{classzhdf_1_1new_aad68ddbb6791ca56a8495047091ccd72}} 
\index{zhdf\+::new@{zhdf\+::new}!ropa@{ropa}}
\index{ropa@{ropa}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{ropa()}{ropa()}\hspace{0.1cm}{\footnotesize\ttfamily [1/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+ropa (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec,  }\item[{}]{save = {\ttfamily False},  }\item[{}]{top = {\ttfamily False},  }\item[{}]{time = {\ttfamily False},  }\item[{}]{plot = {\ttfamily True},  }\item[{}]{net = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create a ropa timeseries
\end{DoxyVerb}
 
\begin{DoxyCode}
292     \textcolor{keyword}{def }ropa(self, spec, save = False, top=False, time = False, plot=True,net= False):
293         \textcolor{stringliteral}{'''}
294 \textcolor{stringliteral}{        Create a ropa timeseries}
295 \textcolor{stringliteral}{        '''}
296         \textcolor{keyword}{import} \mbox{\hyperlink{namespacematplotlib_1_1pyplot}{matplotlib.pyplot}} \textcolor{keyword}{as} plt
297         pr = self.prod(spec)
298         ls = self.loss(spec)
299 
300         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} time: time=self.ts
301 
302         prod = abs(self.flux.loc[time,pr]).compute()
303         prod = prod[prod.mean().sort\_values(ascending=\textcolor{keyword}{True}).index]
304 
305         loss = abs(self.flux.loc[time,ls]).compute()
306         loss = loss[loss.mean().sort\_values(ascending=\textcolor{keyword}{True}).index]
307 
308 
309         \textcolor{keywordflow}{if} top:
310             plt.close()
311             prod=prod[prod.columns[-top:]]
312             loss=loss[loss.columns[-top:]]
313 
314 
315         \textcolor{keywordflow}{if} net:
316             plot=\textcolor{keyword}{False}
317             (prod.sum(axis=1)-loss.sum(axis=1)).plot(c=\textcolor{stringliteral}{'orange'},legend=\textcolor{keyword}{False})
318             plt.ticklabel\_format(style=\textcolor{stringliteral}{'sci'}, axis=\textcolor{stringliteral}{'y'}, scilimits=(-2,2))
319             \textcolor{keywordflow}{if} save:
320                 plt.savefig(save)
321 
322 
323         \textcolor{keywordflow}{if} plot:
324             \textcolor{keyword}{from} matplotlib \textcolor{keyword}{import} colors
325             \textcolor{keyword}{from} matplotlib \textcolor{keyword}{import} cm
326 
327             x = np.linspace( .9,.3, 256)
328             red = colors.LinearSegmentedColormap.from\_list(\textcolor{stringliteral}{''},cm.Reds(x))
329             blue = colors.LinearSegmentedColormap.from\_list(\textcolor{stringliteral}{''},cm.Blues(x))
330 
331             plt.close()
332             plt.style.use(\textcolor{stringliteral}{'seaborn-darkgrid'})
333             fig = plt.figure(1)
334             ax0=plt.subplot(211)
335             \textcolor{keywordflow}{try}:prod.plot.area(colormap=red,legend=\textcolor{keyword}{False},ax=ax0, alpha=.7,stacked=\textcolor{keyword}{True})
336             \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
337             \textcolor{comment}{#ax.xlabel('')}
338             ax0.tick\_params(
339                 axis=\textcolor{stringliteral}{'x'},          \textcolor{comment}{# changes apply to the x-axis}
340                 which=\textcolor{stringliteral}{'both'},      \textcolor{comment}{# both major and minor ticks are affected}
341                 bottom=\textcolor{keyword}{False},      \textcolor{comment}{# ticks along the bottom edge are off}
342                 top=\textcolor{keyword}{False},         \textcolor{comment}{# ticks along the top edge are off}
343                 labelbottom=\textcolor{keyword}{False})
344             ax0.ticklabel\_format(style=\textcolor{stringliteral}{'sci'}, axis=\textcolor{stringliteral}{'y'}, scilimits=(-2,2))
345 
346             ax = plt.subplot(212,sharex=ax0)
347             \textcolor{keywordflow}{try}:loss.plot.area(colormap=blue,legend=\textcolor{keyword}{False},ax=ax, alpha=.7,stacked=\textcolor{keyword}{True})
348             \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
349             ax.axes.invert\_yaxis()
350             plt.figlegend()
351             ax.ticklabel\_format(style=\textcolor{stringliteral}{'sci'}, axis=\textcolor{stringliteral}{'y'}, scilimits=(-2,2))
352 
353             plt.subplots\_adjust(left=\textcolor{keywordtype}{None}, bottom=\textcolor{keywordtype}{None}, right=\textcolor{keywordtype}{None}, top=\textcolor{keywordtype}{None}, wspace=\textcolor{keywordtype}{None}, hspace=0.001)
354             plt.show()
355             \textcolor{keywordflow}{if} save:
356                 fig.savefig(save)
357         \textcolor{keywordflow}{return} \{\textcolor{stringliteral}{'prod'}:prod,\textcolor{stringliteral}{'loss'}:loss\}
358 
359 
360 
\end{DoxyCode}
\mbox{\Hypertarget{classzhdf_1_1new_aad68ddbb6791ca56a8495047091ccd72}\label{classzhdf_1_1new_aad68ddbb6791ca56a8495047091ccd72}} 
\index{zhdf\+::new@{zhdf\+::new}!ropa@{ropa}}
\index{ropa@{ropa}!zhdf\+::new@{zhdf\+::new}}
\subsubsection{\texorpdfstring{ropa()}{ropa()}\hspace{0.1cm}{\footnotesize\ttfamily [2/2]}}
{\footnotesize\ttfamily def zhdf.\+new.\+ropa (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{spec,  }\item[{}]{save = {\ttfamily False},  }\item[{}]{top = {\ttfamily False},  }\item[{}]{time = {\ttfamily False},  }\item[{}]{plot = {\ttfamily True},  }\item[{}]{net = {\ttfamily False} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create a ropa timeseries
\end{DoxyVerb}
 
\begin{DoxyCode}
339     \textcolor{keyword}{def }ropa(self, spec, save = False, top=False, time = False, plot=True,net= False):
340         \textcolor{stringliteral}{'''}
341 \textcolor{stringliteral}{        Create a ropa timeseries}
342 \textcolor{stringliteral}{        '''}
343         \textcolor{keyword}{import} \mbox{\hyperlink{namespacematplotlib_1_1pyplot}{matplotlib.pyplot}} \textcolor{keyword}{as} plt
344         pr = self.prod(spec)
345         ls = self.loss(spec)
346 
347         \textcolor{keywordflow}{if} \textcolor{keywordflow}{not} time: time=self.ts
348 
349         prod = abs(self.flux.loc[time,pr]).compute()
350         prod = prod[prod.mean().sort\_values(ascending=\textcolor{keyword}{True}).index]
351 
352         loss = abs(self.flux.loc[time,ls]).compute()
353         loss = loss[loss.mean().sort\_values(ascending=\textcolor{keyword}{True}).index]
354 
355 
356         \textcolor{keywordflow}{if} top:
357             plt.close()
358             prod=prod[prod.columns[-top:]]
359             loss=loss[loss.columns[-top:]]
360 
361 
362         \textcolor{keywordflow}{if} net:
363             plot=\textcolor{keyword}{False}
364             (prod.sum(axis=1)-loss.sum(axis=1)).plot(c=\textcolor{stringliteral}{'orange'},legend=\textcolor{keyword}{False})
365             plt.ticklabel\_format(style=\textcolor{stringliteral}{'sci'}, axis=\textcolor{stringliteral}{'y'}, scilimits=(-2,2))
366             \textcolor{keywordflow}{if} save:
367                 plt.savefig(save)
368 
369 
370         \textcolor{keywordflow}{if} plot:
371             \textcolor{keyword}{from} matplotlib \textcolor{keyword}{import} colors
372             \textcolor{keyword}{from} matplotlib \textcolor{keyword}{import} cm
373 
374             x = np.linspace( .9,.3, 256)
375             red = colors.LinearSegmentedColormap.from\_list(\textcolor{stringliteral}{''},cm.Reds(x))
376             blue = colors.LinearSegmentedColormap.from\_list(\textcolor{stringliteral}{''},cm.Blues(x))
377 
378             plt.close()
379             plt.style.use(\textcolor{stringliteral}{'seaborn-darkgrid'})
380             fig = plt.figure(1)
381             ax0=plt.subplot(211)
382             \textcolor{keywordflow}{try}:prod.plot.area(colormap=red,legend=\textcolor{keyword}{False},ax=ax0, alpha=.7,stacked=\textcolor{keyword}{True})
383             \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
384             \textcolor{comment}{#ax.xlabel('')}
385             ax0.tick\_params(
386                 axis=\textcolor{stringliteral}{'x'},          \textcolor{comment}{# changes apply to the x-axis}
387                 which=\textcolor{stringliteral}{'both'},      \textcolor{comment}{# both major and minor ticks are affected}
388                 bottom=\textcolor{keyword}{False},      \textcolor{comment}{# ticks along the bottom edge are off}
389                 top=\textcolor{keyword}{False},         \textcolor{comment}{# ticks along the top edge are off}
390                 labelbottom=\textcolor{keyword}{False})
391             ax0.ticklabel\_format(style=\textcolor{stringliteral}{'sci'}, axis=\textcolor{stringliteral}{'y'}, scilimits=(-2,2))
392 
393             ax = plt.subplot(212,sharex=ax0)
394             \textcolor{keywordflow}{try}:loss.plot.area(colormap=blue,legend=\textcolor{keyword}{False},ax=ax, alpha=.7,stacked=\textcolor{keyword}{True})
395             \textcolor{keywordflow}{except}:\textcolor{keywordtype}{None}
396             ax.axes.invert\_yaxis()
397             plt.figlegend()
398             ax.ticklabel\_format(style=\textcolor{stringliteral}{'sci'}, axis=\textcolor{stringliteral}{'y'}, scilimits=(-2,2))
399 
400             plt.subplots\_adjust(left=\textcolor{keywordtype}{None}, bottom=\textcolor{keywordtype}{None}, right=\textcolor{keywordtype}{None}, top=\textcolor{keywordtype}{None}, wspace=\textcolor{keywordtype}{None}, hspace=0.001)
401             plt.show()
402             \textcolor{keywordflow}{if} save:
403                 fig.savefig(save)
404         \textcolor{keywordflow}{return} \{\textcolor{stringliteral}{'prod'}:prod,\textcolor{stringliteral}{'loss'}:loss\}
405 
406 
407 
\end{DoxyCode}


The documentation for this class was generated from the following file\+:\begin{DoxyCompactItemize}
\item 
Other/\+Iterative\+Temporal\+Page\+Rank/zhdf.\+py\end{DoxyCompactItemize}
