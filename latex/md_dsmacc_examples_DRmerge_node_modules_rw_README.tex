How do you read a file from stdin? If you thought,


\begin{DoxyCode}
var contents = fs.readFileSync("/dev/stdin", "utf8");
\end{DoxyCode}


you’d be wrong, because \mbox{\hyperlink{classNode}{Node}} only reads up to the size of the file reported by fs.\+stat rather than reading until it receives an E\+OF. So, if you redirect a file to your program ({\ttfamily cat file $\vert$ program}), you’ll only read the first 65,536 bytes of your file. Oops.

What about writing a file to stdout? If you thought,


\begin{DoxyCode}
fs.writeFileSync("/dev/stdout", contents, "utf8");
\end{DoxyCode}


you’d also be wrong, because this tries to close stdout, so you get this error\+:


\begin{DoxyCode}
Error: UNKNOWN, unknown error
    at Object.fs.writeSync (fs.js:528:18)
    at Object.fs.writeFileSync (fs.js:975:21)
\end{DoxyCode}


(Also, this doesn’t work on Windows, because Windows doesn’t support /dev/stdout, /dev/stdin and /dev/stderr!)

Shucks. So what should you do?

You could use a different pattern for reading from stdin\+:


\begin{DoxyCode}
var chunks = [];

process.stdin
    .on("data", function(chunk) \{ chunks.push(chunk); \})
    .on("end", function() \{ console.log(chunks.join("").length); \})
    .setEncoding("utf8");
\end{DoxyCode}


But that’s a pain, since now your code has two different code paths for reading inputs depending on whether you’re reading a real file or stdin. And the code gets even more complex if you want to \href{https://github.com/mbostock/rw/blob/master/lib/rw/read-file-sync.js}{\tt read that file synchronously}.

You could also try a different pattern for writing to stdout\+:


\begin{DoxyCode}
process.stdout.write(contents);
\end{DoxyCode}


Or even\+:


\begin{DoxyCode}
console.log(contents);
\end{DoxyCode}


But if you try to pipe your output to {\ttfamily head}, you’ll get this error\+:


\begin{DoxyCode}
Error: write EPIPE
    at errnoException (net.js:904:11)
    at Object.afterWrite (net.js:720:19)
\end{DoxyCode}


Huh.

The {\bfseries rw} module fixes these problems. It provides an interface just like read\+File, read\+File\+Sync, write\+File and write\+File\+Sync, but with implementations that work the way you expect on stdin and stdout. If you use these methods on files other than /dev/stdin or /dev/stdout, they simply delegate to the fs methods, so you can trust that they behave identically to the methods you’re used to.

For example, now you can read stdin synchronously like so\+:


\begin{DoxyCode}
var contents = rw.readFileSync("/dev/stdin", "utf8");
\end{DoxyCode}


Or to write to stdout\+:


\begin{DoxyCode}
rw.writeFileSync("/dev/stdout", contents, "utf8");
\end{DoxyCode}


And rw automatically squashes E\+P\+I\+PE errors, so you can pipe the output of your program to {\ttfamily head} and you won’t get a spurious stack trace.

To install, {\ttfamily npm install rw}.

\subsubsection*{Note}

If you want to read synchronously from stdin using \href{#readFileSync}{\tt read\+File\+Sync}, you cannot also use process.\+stdin in the same program. Likewise, if you want to write synchronously to stdout or stderr using \href{#writeFileSync}{\tt write\+File\+Sync}, you cannot use process.\+stdout or process.\+stderr, respectively. (This includes using console.\+log and the like!) Failure to heed this warning may result in error\+: E\+A\+G\+A\+IN, resource temporarily unavailable. Unfortunately, it does not appear possible for this library to fix this issue automatically, so please use caution.

Only the asynchronous methods \href{#readFile}{\tt read\+File} and \href{#writeFile}{\tt write\+File} are supported on Windows. \mbox{\hyperlink{classNode}{Node}} has no synchronous A\+PI for reading from process.\href{https://nodejs.org/api/process.html#process_process_stdin}{\tt stdin} or writing to process.\href{https://nodejs.org/api/process.html#process_process_stdout}{\tt stdout} or process.\href{https://nodejs.org/api/process.html#process_process_stderr}{\tt stderr}, so you’re out of luck!

\subsection*{A\+PI Reference}

\label{_readFile}%
\# rw.{\bfseries read\+File}({\itshape path}\mbox{[}, {\itshape options}\mbox{]}, {\itshape callback})

Reads the file at the specified {\itshape path} completely into memory, invoking the specified {\itshape callback} once the data is available and the file is closed. The {\itshape callback} is invoked with two arguments\+: the {\itshape error} that occurred during read (hopefully null), and the read data. If {\itshape options} is a string, it specifies the encoding to use, in which case the read data will be a string; otherwise {\itshape options} is an object, and may specify encoding and flag properties. This method is a drop-\/in replacement for \href{https://nodejs.org/api/fs.html#fs_fs_readfile_file_options_callback}{\tt fs.\+read\+File} and fixes the behavior of special files such as /dev/stdin.

\label{_readFileSync}%
\# rw.{\bfseries read\+File\+Sync}({\itshape path}\mbox{[}, {\itshape options}\mbox{]})

Reads the file at the specified {\itshape path} completely into memory, synchronously, returning the data. If an error occurred during read, this function throws an error instead. If {\itshape options} is a string, it specifies the encoding to use, in which case the read data will be a string; otherwise {\itshape options} is an object, and may specify encoding and flag properties. This method is a drop-\/in replacement for \href{https://nodejs.org/api/fs.html#fs_fs_readfilesync_file_options}{\tt fs.\+read\+File\+Sync} and fixes the behavior of special files such as /dev/stdin.

\label{_writeFile}%
\# rw.{\bfseries write\+File}({\itshape path}, {\itshape data}\mbox{[}, {\itshape options}\mbox{]}, {\itshape callback})

Writes the specified {\itshape data} (completely in memory) to a file at the specified {\itshape path}, invoking the specified {\itshape callback} once the data is completely written and the file is closed. The {\itshape callback} is invoked with a single argument\+: the {\itshape error} that occurred during write (hopefully null). If {\itshape options} is a string, it specifies the encoding to use, in which case the {\itshape data} must be a string; otherwise {\itshape options} is an object, and may specify encoding, mode and flag properties. This method is a drop-\/in replacement for \href{https://nodejs.org/api/fs.html#fs_fs_writefile_file_data_options_callback}{\tt fs.\+write\+File} and fixes the behavior of special files such as /dev/stdout.

\label{_writeFileSync}%
\# rw.{\bfseries write\+File\+Sync}({\itshape path}, {\itshape data}\mbox{[}, {\itshape options}\mbox{]})

Writes the specified {\itshape data} (completely in memory) to a file at the specified {\itshape path}, synchronously, returning once the data is completely written and the file is closed. Throws an {\itshape error} if one occurs during write. If {\itshape options} is a string, it specifies the encoding to use, in which case the {\itshape data} must be a string; otherwise {\itshape options} is an object, and may specify encoding, mode and flag properties. This method is a drop-\/in replacement for \href{https://nodejs.org/api/fs.html#fs_fs_writefilesync_file_data_options}{\tt fs.\+write\+File\+Sync} and fixes the behavior of special files such as /dev/stdout.

\label{_dash_readFile}%
\# rw.\+dash.{\bfseries read\+File}({\itshape path}\mbox{[}, {\itshape options}\mbox{]}, {\itshape callback})

Equivalent to \href{#readFile}{\tt rw.\+read\+File}, except treats a {\itshape path} of {\ttfamily -\/} as {\ttfamily /dev/stdin}. Useful for command-\/line arguments.

\label{_dash_readFileSync}%
\# rw.\+dash.{\bfseries read\+File\+Sync}({\itshape path}\mbox{[}, {\itshape options}\mbox{]})

Equivalent to \href{#readFileSync}{\tt rw.\+read\+File\+Sync}, except treats a {\itshape path} of {\ttfamily -\/} as {\ttfamily /dev/stdin}. Useful for command-\/line arguments.

\label{_dash_writeFile}%
\# rw.\+dash.{\bfseries write\+File}({\itshape path}, {\itshape data}\mbox{[}, {\itshape options}\mbox{]}, {\itshape callback})

Equivalent to \href{#writeFile}{\tt rw.\+write\+File}, except treats a {\itshape path} of {\ttfamily -\/} as {\ttfamily /dev/stdout}. Useful for command-\/line arguments.

\label{_dash_writeFileSync}%
\# rw.\+dash.{\bfseries write\+File\+Sync}({\itshape path}, {\itshape data}\mbox{[}, {\itshape options}\mbox{]})

Equivalent to \href{#writeFileSync}{\tt rw.\+write\+File\+Sync}, except treats a {\itshape path} of {\ttfamily -\/} as {\ttfamily /dev/stdout}. Useful for command-\/line arguments. 