\hypertarget{namespacedsmacc_1_1graph_1_1graph}{}\section{dsmacc.\+graph.\+graph Namespace Reference}
\label{namespacedsmacc_1_1graph_1_1graph}\index{dsmacc.\+graph.\+graph@{dsmacc.\+graph.\+graph}}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\Hypertarget{namespacedsmacc_1_1graph_1_1graph_a936253bffd65ad8d19a579f5f1f6928d}\label{namespacedsmacc_1_1graph_1_1graph_a936253bffd65ad8d19a579f5f1f6928d}} 
def {\bfseries normalise} (x)
\item 
def \mbox{\hyperlink{namespacedsmacc_1_1graph_1_1graph_a63af59bfa3dc885cc6d4f1ac1e79ac0f}{jgraph}} (posjac)
\item 
\mbox{\Hypertarget{namespacedsmacc_1_1graph_1_1graph_aedbc1be59c07dbc546f749f1cf1ca6f7}\label{namespacedsmacc_1_1graph_1_1graph_aedbc1be59c07dbc546f749f1cf1ca6f7}} 
def {\bfseries rm\+\_\+nodes} (G, ignore)
\item 
def \mbox{\hyperlink{namespacedsmacc_1_1graph_1_1graph_a92150b89f1671886a95899c7f6a1b139}{getnx}} (self, ts, save=False, ignore=\mbox{[}$\,$\mbox{]})
\item 
\mbox{\Hypertarget{namespacedsmacc_1_1graph_1_1graph_a175256816c6dbcbff6cdfff8e38eaf24}\label{namespacedsmacc_1_1graph_1_1graph_a175256816c6dbcbff6cdfff8e38eaf24}} 
def {\bfseries pagerank} (a)
\item 
def \mbox{\hyperlink{namespacedsmacc_1_1graph_1_1graph_af1100c886b7f48a0287ba1fe0accc785}{tograph}} (jac)
\item 
def \mbox{\hyperlink{namespacedsmacc_1_1graph_1_1graph_addafb8b938b7dc46ee5f4e87b0dc0ebe}{metric}} (GS, met=\textquotesingle{}nx.\+pagerank\textquotesingle{})
\item 
\mbox{\Hypertarget{namespacedsmacc_1_1graph_1_1graph_a07f7e22ebaffb85b3ad1c87dae258198}\label{namespacedsmacc_1_1graph_1_1graph_a07f7e22ebaffb85b3ad1c87dae258198}} 
def {\bfseries geobj2df} (GS, what=\textquotesingle{}nx.\+pagerank\textquotesingle{})
\end{DoxyCompactItemize}


\subsection{Detailed Description}
\begin{DoxyVerb}graph generation library to use networkx
\end{DoxyVerb}
 

\subsection{Function Documentation}
\mbox{\Hypertarget{namespacedsmacc_1_1graph_1_1graph_a92150b89f1671886a95899c7f6a1b139}\label{namespacedsmacc_1_1graph_1_1graph_a92150b89f1671886a95899c7f6a1b139}} 
\index{dsmacc\+::graph\+::graph@{dsmacc\+::graph\+::graph}!getnx@{getnx}}
\index{getnx@{getnx}!dsmacc\+::graph\+::graph@{dsmacc\+::graph\+::graph}}
\subsubsection{\texorpdfstring{getnx()}{getnx()}}
{\footnotesize\ttfamily def dsmacc.\+graph.\+graph.\+getnx (\begin{DoxyParamCaption}\item[{}]{self,  }\item[{}]{ts,  }\item[{}]{save = {\ttfamily False},  }\item[{}]{ignore = {\ttfamily \mbox{[}\mbox{]}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}Create a networkx graph from a DSMACC new class

Usage: 
    getnx(a,a.ts[-1], 'propane')
\end{DoxyVerb}
 
\begin{DoxyCode}
44 \textcolor{keyword}{def }getnx(self, ts ,save=False,ignore=[] ):
45     \textcolor{stringliteral}{'''}
46 \textcolor{stringliteral}{    Create a networkx graph from a DSMACC new class}
47 \textcolor{stringliteral}{    }
48 \textcolor{stringliteral}{    Usage: }
49 \textcolor{stringliteral}{        getnx(a,a.ts[-1], 'propane')}
50 \textcolor{stringliteral}{    '''}
51     \textcolor{keywordflow}{try}: self.posjac
52     \textcolor{keywordflow}{except}:self.create\_posjac()
53     
54     G = nx.DiGraph()
55     
56     posjac = self.posjac.loc[ts,:]
57     split = [i.split(\textcolor{stringliteral}{'->'}) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} posjac.index]
58     
59     p = [i \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} posjac \textcolor{keywordflow}{if} i != 0 ]
60     mn = np.min(p)
61     mx = np.log10(np.max(p) - mn )
62     mn = np.log10(mn)
63     \textcolor{keywordflow}{for} e \textcolor{keywordflow}{in} range(len(split)):
64         \textcolor{keywordflow}{if} posjac[e] > 0 :
65             G.add\_edge(split[e][0],split[e][1],weight=1e-4+(np.log10(posjac[e])-mn)/mx )
66     G.remove\_edges\_from(G.selfloop\_edges())
67     
68     \textcolor{comment}{#no more zero concentration edges}
69     G = rm\_nodes (G, set(G.nodes()) - set(self.spec.columns))
70     G = rm\_nodes (G, ignore)
71     \textcolor{comment}{#rm isolates}
72     G = rm\_nodes(G,list(nx.isolates(G)))
73 
74     
75     
76     \textcolor{keywordflow}{if} save:
77         nx.write\_weighted\_edgelist(G, save+\textcolor{stringliteral}{'.wedgelist'})
78     \textcolor{comment}{#G=nx.read\_weighted\_edgelist('propane.wedgelist',create\_using=nx.DiGraph)}
79 
80     \textcolor{keywordflow}{return} G 
81 
82     
83     
84     
85 
86 
87 
88 
89 
90 
91 
92 
93 
94 
\end{DoxyCode}
\mbox{\Hypertarget{namespacedsmacc_1_1graph_1_1graph_a63af59bfa3dc885cc6d4f1ac1e79ac0f}\label{namespacedsmacc_1_1graph_1_1graph_a63af59bfa3dc885cc6d4f1ac1e79ac0f}} 
\index{dsmacc\+::graph\+::graph@{dsmacc\+::graph\+::graph}!jgraph@{jgraph}}
\index{jgraph@{jgraph}!dsmacc\+::graph\+::graph@{dsmacc\+::graph\+::graph}}
\subsubsection{\texorpdfstring{jgraph()}{jgraph()}}
{\footnotesize\ttfamily def dsmacc.\+graph.\+graph.\+jgraph (\begin{DoxyParamCaption}\item[{}]{posjac }\end{DoxyParamCaption})}

\begin{DoxyVerb}networkx graph object from posjac at timestep
\end{DoxyVerb}
 
\begin{DoxyCode}
16 \textcolor{keyword}{def }jgraph(posjac):
17     \textcolor{stringliteral}{'''}
18 \textcolor{stringliteral}{    networkx graph object from posjac at timestep}
19 \textcolor{stringliteral}{    '''}
20 
21     posjac = 1 - normalise(np.log10(posjac).replace([np.inf,-np.inf],np.nan).dropna())
22 
23     split = [i.split(\textcolor{stringliteral}{'->'}) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} posjac.index]
24     \textcolor{comment}{#graph}
25     G = nx.DiGraph()
26 
27     \textcolor{keywordflow}{for} e \textcolor{keywordflow}{in} range(len(split)):
28 
29             G.add\_edge(split[e][0],split[e][1],weight=posjac[e])
30 
31     G.remove\_edges\_from(G.selfloop\_edges())
32 
33 
34     \textcolor{keywordflow}{return} G
35 
36 
37     
\end{DoxyCode}
\mbox{\Hypertarget{namespacedsmacc_1_1graph_1_1graph_addafb8b938b7dc46ee5f4e87b0dc0ebe}\label{namespacedsmacc_1_1graph_1_1graph_addafb8b938b7dc46ee5f4e87b0dc0ebe}} 
\index{dsmacc\+::graph\+::graph@{dsmacc\+::graph\+::graph}!metric@{metric}}
\index{metric@{metric}!dsmacc\+::graph\+::graph@{dsmacc\+::graph\+::graph}}
\subsubsection{\texorpdfstring{metric()}{metric()}}
{\footnotesize\ttfamily def dsmacc.\+graph.\+graph.\+metric (\begin{DoxyParamCaption}\item[{}]{GS,  }\item[{}]{met = {\ttfamily \textquotesingle{}nx.pagerank\textquotesingle{}} }\end{DoxyParamCaption})}

\begin{DoxyVerb}GS - out array from to_graph
\end{DoxyVerb}
 
\begin{DoxyCode}
135 \textcolor{keyword}{def }metric(GS,met = 'nx.pagerank'):
136     \textcolor{stringliteral}{'''}
137 \textcolor{stringliteral}{    GS - out array from to\_graph}
138 \textcolor{stringliteral}{    '''}
139     metfn = eval(met)
140 
141     \textcolor{keywordflow}{for} gt \textcolor{keywordflow}{in} range(len(GS)):
142         res = metfn(GS[gt][\textcolor{stringliteral}{'graph'}])
143         res = [[key, res[key]] \textcolor{keywordflow}{for} key, value \textcolor{keywordflow}{in} sorted(res.iteritems(), key=\textcolor{keyword}{lambda} k,v: (v,k))]
144 
145         GS[gt][met] = res
146     \textcolor{keywordflow}{return} GS
147 
148 
\end{DoxyCode}
\mbox{\Hypertarget{namespacedsmacc_1_1graph_1_1graph_af1100c886b7f48a0287ba1fe0accc785}\label{namespacedsmacc_1_1graph_1_1graph_af1100c886b7f48a0287ba1fe0accc785}} 
\index{dsmacc\+::graph\+::graph@{dsmacc\+::graph\+::graph}!tograph@{tograph}}
\index{tograph@{tograph}!dsmacc\+::graph\+::graph@{dsmacc\+::graph\+::graph}}
\subsubsection{\texorpdfstring{tograph()}{tograph()}}
{\footnotesize\ttfamily def dsmacc.\+graph.\+graph.\+tograph (\begin{DoxyParamCaption}\item[{}]{jac }\end{DoxyParamCaption})}

\begin{DoxyVerb}Use hourly avg
\end{DoxyVerb}
 
\begin{DoxyCode}
100 \textcolor{keyword}{def }tograph(jac):
101     \textcolor{stringliteral}{'''}
102 \textcolor{stringliteral}{    Use hourly avg}
103 \textcolor{stringliteral}{    '''}
104 
105     rt = []
106     \textcolor{keywordflow}{for} t \textcolor{keywordflow}{in} jac.iterrows():
107         jacsp=t[1]
108         \textcolor{comment}{#inverse negative links}
109         index = np.array(jacsp.index)
110         lt = list(jacsp<0)
111         index[lt] = map(\textcolor{keyword}{lambda} x: \textcolor{stringliteral}{'->'}.join(reversed(x.split(\textcolor{stringliteral}{'->'}))),index[lt])
112         jacsp.index = index
113         jacsp = jacsp.abs()
114 
115         \textcolor{comment}{#normalize jacsp}
116         jacsp  = jacsp*1.01 - jacsp.min().min()
117         jacsp /= jacsp.max().max()
118 
119 
120         split = [i.split(\textcolor{stringliteral}{'->'}) \textcolor{keywordflow}{for} i \textcolor{keywordflow}{in} jacsp.index]
121         \textcolor{comment}{#graph}
122         G = nx.DiGraph()
123 
124         \textcolor{keywordflow}{for} e \textcolor{keywordflow}{in} range(len(split)):
125 
126             G.add\_edge(split[e][0],split[e][1],weight=jacsp[e])
127 
128 
129         G.remove\_edges\_from(G.selfloop\_edges())
130         rt.append(\{\textcolor{stringliteral}{'graph'}:G,\textcolor{stringliteral}{'time'}:t[0]\})
131 
132     \textcolor{keywordflow}{return} rt
133 
134 
\end{DoxyCode}
