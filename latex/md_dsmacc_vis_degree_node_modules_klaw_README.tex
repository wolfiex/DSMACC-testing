A Node.\+js file system walker extracted from \href{https://github.com/jprichardson/node-fs-extra}{\tt fs-\/extra}.

\href{https://www.npmjs.org/package/klaw}{\tt } \href{http://travis-ci.org/jprichardson/node-klaw}{\tt } \href{https://ci.appveyor.com/project/jprichardson/node-klaw/branch/master}{\tt }

\href{http://standardjs.com}{\tt }

\subsection*{Install }

\begin{DoxyVerb}npm i --save klaw
\end{DoxyVerb}


\subsection*{Name }

{\ttfamily klaw} is {\ttfamily walk} backwards \+:p

\subsection*{Usage }

\subsubsection*{klaw(directory, \mbox{[}options\mbox{]})}

Returns a \href{https://nodejs.org/api/stream.html#stream_class_stream_readable}{\tt Readable stream} that iterates through every file and directory starting with {\ttfamily dir} as the root. Every {\ttfamily read()} or {\ttfamily data} event returns an object with two properties\+: {\ttfamily path} and {\ttfamily stats}. {\ttfamily path} is the full path of the file and {\ttfamily stats} is an instance of \href{https://nodejs.org/api/fs.html#fs_class_fs_stats}{\tt fs.\+Stats}.


\begin{DoxyItemize}
\item {\ttfamily directory}\+: The directory to recursively walk. Type {\ttfamily string}.
\item {\ttfamily options}\+: \href{https://nodejs.org/api/stream.html#stream_new_stream_readable_options}{\tt Readable stream options} and the following\+:
\begin{DoxyItemize}
\item {\ttfamily queue\+Method} ({\ttfamily string}, default\+: `\textquotesingle{}shift'{\ttfamily )\+: Either}\textquotesingle{}shift\textquotesingle{}{\ttfamily or}\textquotesingle{}pop\textquotesingle{}{\ttfamily . On}readdir(){\ttfamily array, call either}shift(){\ttfamily or}pop(){\ttfamily . -\/}path\+Sorter{\ttfamily (}function{\ttfamily , default\+:}undefined{\ttfamily )\+: Sorting \mbox{[}function for Arrays\mbox{]}(\href{https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort}{\tt https\+://developer.\+mozilla.\+org/en-\/\+U\+S/docs/\+Web/\+Java\+Script/\+Reference/\+Global\+\_\+\+Objects/\+Array/sort}). -\/}fs{\ttfamily (}object{\ttfamily , default\+:}require(\textquotesingle{}fs\textquotesingle{}){\ttfamily )\+: Use this to hook into the}fs{\ttfamily methods or to use \mbox{[}}mock-\/fs{\ttfamily \mbox{]}(\href{https://github.com/tschaub/mock-fs}{\tt https\+://github.\+com/tschaub/mock-\/fs}) -\/}filter{\ttfamily (}function{\ttfamily , default\+:}undefined\`{})\+: Filtering \href{https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter}{\tt function for Arrays}
\end{DoxyItemize}
\end{DoxyItemize}

{\bfseries Streams 1 (push) example\+:}


\begin{DoxyCode}
var klaw = require('klaw')

var items = [] // files, directories, symlinks, etc
klaw('/some/dir')
  .on('data', function (item) \{
    items.push(item.path)
  \})
  .on('end', function () \{
    console.dir(items) // => [ ... array of files]
  \})
\end{DoxyCode}


{\bfseries Streams 2 \& 3 (pull) example\+:}


\begin{DoxyCode}
var klaw = require('klaw')

var items = [] // files, directories, symlinks, etc
klaw('/some/dir')
  .on('readable', function () \{
    var item
    while ((item = this.read())) \{
      items.push(item.path)
    \}
  \})
  .on('end', function () \{
    console.dir(items) // => [ ... array of files]
  \})
\end{DoxyCode}


If you\textquotesingle{}re not sure of the differences on Node.\+js streams 1, 2, 3 then I\textquotesingle{}d recommend this resource as a good starting point\+: \href{https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/}{\tt https\+://strongloop.\+com/strongblog/whats-\/new-\/io-\/js-\/beta-\/streams3/}.

\subsubsection*{Error Handling}

Listen for the {\ttfamily error} event.

Example\+:


\begin{DoxyCode}
var klaw = require('klaw')
klaw('/some/dir')
  .on('readable', function () \{
    var item
    while ((item = this.read())) \{
      // do something with the file
    \}
  \})
  .on('error', function (err, item) \{
    console.log(err.message)
    console.log(item.path) // the file the error occurred on
  \})
  .on('end', function () \{
    console.dir(items) // => [ ... array of files]
  \})
\end{DoxyCode}


\subsubsection*{Aggregation / Filtering / Executing Actions (Through Streams)}

On many occasions you may want to filter files based upon size, extension, etc. Or you may want to aggregate stats on certain file types. Or maybe you want to perform an action on certain file types.

You should use the module \href{https://www.npmjs.com/package/through2}{\tt {\ttfamily through2}} to easily accomplish this.

Install {\ttfamily through2}\+: \begin{DoxyVerb}npm i --save through2
\end{DoxyVerb}


{\bfseries Example (skipping directories)\+:}


\begin{DoxyCode}
var klaw = require('klaw')
var through2 = require('through2')

var excludeDirFilter = through2.obj(function (item, enc, next) \{
  if (!item.stats.isDirectory()) this.push(item)
  next()
\})

var items = [] // files, directories, symlinks, etc
klaw('/some/dir')
  .pipe(excludeDirFilter)
  .on('data', function (item) \{
    items.push(item.path)
  \})
  .on('end', function () \{
    console.dir(items) // => [ ... array of files without directories]
  \})
\end{DoxyCode}
 {\bfseries Example (ignore hidden directories)\+:} 
\begin{DoxyCode}
var klaw = require('klaw')
var path = require('path')

var filterFunc = function(item)\{
  var basename = path.basename(item)
  return basename === '.' || basename[0] !== '.'
\}

klaw('/some/dir', \{ filter : filterFunc  \})
  .on('data', function(item)\{
    // only items of none hidden folders will reach here
  \})
\end{DoxyCode}


{\bfseries Example (totaling size of P\+NG files)\+:}


\begin{DoxyCode}
var klaw = require('klaw')
var path = require('path')
var through2 = require('through2')

var totalPngsInBytes = 0
var aggregatePngSize = through2.obj(function (item, enc, next) \{
  if (path.extname(item.path) === '.png') \{
    totalPngsInBytes += item.stats.size
  \}
  this.push(item)
  next()
\})

klaw('/some/dir')
  .pipe(aggregatePngSize)
  .on('data', function (item) \{
    items.push(item.path)
  \})
  .on('end', function () \{
    console.dir(totalPngsInBytes) // => total of all pngs (bytes)
  \})
\end{DoxyCode}


{\bfseries Example (deleting all .tmp files)\+:}


\begin{DoxyCode}
var fs = require('fs')
var klaw = require('klaw')
var through2 = require('through2')

var deleteAction = through2.obj(function (item, enc, next) \{
  this.push(item)

  if (path.extname(item.path) === '.tmp') \{
    item.deleted = true
    fs.unklink(item.path, next)
  \} else \{
    item.deleted = false
    next()
  \}  
\})

var deletedFiles = []
klaw('/some/dir')
  .pipe(deleteAction)
  .on('data', function (item) \{
    if (!item.deleted) return
    deletedFiles.push(item.path)
  \})
  .on('end', function () \{
    console.dir(deletedFiles) // => all deleted files
  \})
\end{DoxyCode}


You can even chain a bunch of these filters and aggregators together. By using multiple pipes.

{\bfseries Example (using multiple filters / aggregators)\+:}


\begin{DoxyCode}
klaw('/some/dir')
  .pipe(filterCertainFiles)
  .pipe(deleteSomeOtherFiles)
  .on('end', function () \{
    console.log('all done!')
  \})
\end{DoxyCode}


{\bfseries Example passing (piping) through errors\+:}

Node.\+js does not {\ttfamily pipe()} errors. This means that the error on one stream, like {\ttfamily klaw} will not pipe through to the next. If you want to do this, do the following\+:


\begin{DoxyCode}
var klaw = require('klaw')
var through2 = require('through2')

var excludeDirFilter = through2.obj(function (item, enc, next) \{
  if (!item.stats.isDirectory()) this.push(item)
  next()
\})

var items = [] // files, directories, symlinks, etc
klaw('/some/dir')
  .on('error', function (err) \{ excludeDirFilter.emit('error', err) \}) // forward the error on
  .pipe(excludeDirFilter)
  .on('data', function (item) \{
    items.push(item.path)
  \})
  .on('end', function () \{
    console.dir(items) // => [ ... array of files without directories]
  \})
\end{DoxyCode}


\subsubsection*{Searching Strategy}

Pass in options for {\ttfamily queue\+Method} and {\ttfamily path\+Sorter} to affect how the file system is recursively iterated. See the code for more details, it\textquotesingle{}s less than 50 lines \+:)

\subsection*{License }

M\+IT

Copyright (c) 2015 \href{https://github.com/jprichardson}{\tt JP Richardson} 