<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DSMACC: JSONStream</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DSMACC
   &#160;<span id="projectnumber">2019</span>
   </div>
   <div id="projectbrief">Changes to DSMACC for the thesis of Daniel Ellis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">JSONStream </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>streaming JSON.parse and stringify</p>
<div class="image">
<img src="https://secure.travis-ci.org/dominictarr/JSONStream.png?branch=master"/>
</div>
<p>## install </p><div class="fragment"><div class="line">## example</div><div class="line"></div><div class="line">``` js</div><div class="line"></div><div class="line">var request = require(&#39;request&#39;)</div><div class="line">  , JSONStream = require(&#39;JSONStream&#39;)</div><div class="line">  , es = require(&#39;event-stream&#39;)</div><div class="line"></div><div class="line">request({url: &#39;http://isaacs.couchone.com/registry/_all_docs&#39;})</div><div class="line">  .pipe(JSONStream.parse(&#39;rows.*&#39;))</div><div class="line">  .pipe(es.mapSync(function (data) {</div><div class="line">    console.error(data)</div><div class="line">    return data</div><div class="line">  }))</div></div><!-- fragment --><h2>JSONStream.parse(path)</h2>
<p>parse stream of values that match a path</p>
<div class="fragment"><div class="line">JSONStream.parse(&#39;rows.*.doc&#39;)</div></div><!-- fragment --><p>The <code>..</code> operator is the recursive descent operator from <a href="http://goessner.net/articles/JsonPath/">JSONPath</a>, which will match a child at any depth (see examples below).</p>
<p>If your keys have keys that include <code>.</code> or <code>*</code> etc, use an array instead. &lsquo;['row&rsquo;, true, /^doc/]`.</p>
<p>If you use an array, <code>RegExp</code>s, booleans, and/or functions. The <code>..</code> operator is also available in array representation, using <code>{recurse: true}</code>. any object that matches the path will be emitted as 'data' (and <code>pipe</code>d down stream)</p>
<p>If <code>path</code> is empty or null, no 'data' events are emitted.</p>
<p>If you want to have keys emitted, you can prefix your <code>*</code> operator with <code>$</code>: <code>obj.$*</code> - in this case the data passed to the stream is an object with a <code>key</code> holding the key and a <code>value</code> property holding the data.</p>
<h3>Examples</h3>
<p>query a couchdb view:</p>
<div class="fragment"><div class="line">curl -sS localhost:5984/tests/_all_docs&amp;include_docs=true</div></div><!-- fragment --><p> you will get something like this:</p>
<div class="fragment"><div class="line">{&quot;total_rows&quot;:129,&quot;offset&quot;:0,&quot;rows&quot;:[</div><div class="line">  { &quot;id&quot;:&quot;change1_0.6995461115147918&quot;</div><div class="line">  , &quot;key&quot;:&quot;change1_0.6995461115147918&quot;</div><div class="line">  , &quot;value&quot;:{&quot;rev&quot;:&quot;1-e240bae28c7bb3667f02760f6398d508&quot;}</div><div class="line">  , &quot;doc&quot;:{</div><div class="line">      &quot;_id&quot;:  &quot;change1_0.6995461115147918&quot;</div><div class="line">    , &quot;_rev&quot;: &quot;1-e240bae28c7bb3667f02760f6398d508&quot;,&quot;hello&quot;:1}</div><div class="line">  },</div><div class="line">  { &quot;id&quot;:&quot;change2_0.6995461115147918&quot;</div><div class="line">  , &quot;key&quot;:&quot;change2_0.6995461115147918&quot;</div><div class="line">  , &quot;value&quot;:{&quot;rev&quot;:&quot;1-13677d36b98c0c075145bb8975105153&quot;}</div><div class="line">  , &quot;doc&quot;:{</div><div class="line">      &quot;_id&quot;:&quot;change2_0.6995461115147918&quot;</div><div class="line">    , &quot;_rev&quot;:&quot;1-13677d36b98c0c075145bb8975105153&quot;</div><div class="line">    , &quot;hello&quot;:2</div><div class="line">    }</div><div class="line">  },</div><div class="line">]}</div></div><!-- fragment --><p>we are probably most interested in the <code>rows.*.doc</code></p>
<p>create a <code>Stream</code> that parses the documents from the feed like this:</p>
<div class="fragment"><div class="line">var stream = JSONStream.parse([&#39;rows&#39;, true, &#39;doc&#39;]) //rows, ANYTHING, doc</div><div class="line"></div><div class="line">stream.on(&#39;data&#39;, function(data) {</div><div class="line">  console.log(&#39;received:&#39;, data);</div><div class="line">});</div><div class="line">//emits anything from _before_ the first match</div><div class="line">stream.on(&#39;header&#39;, function (data) {</div><div class="line">  console.log(&#39;header:&#39;, data) // =&gt; {&quot;total_rows&quot;:129,&quot;offset&quot;:0}</div><div class="line">})</div></div><!-- fragment --><p> awesome!</p>
<p>In case you wanted the contents the doc emitted:</p>
<div class="fragment"><div class="line">var stream = JSONStream.parse([&#39;rows&#39;, true, &#39;doc&#39;, {emitKey: true}]) //rows, ANYTHING, doc, items in docs with keys</div><div class="line"></div><div class="line">stream.on(&#39;data&#39;, function(data) {</div><div class="line">  console.log(&#39;key:&#39;, data.key);</div><div class="line">  console.log(&#39;value:&#39;, data.value);</div><div class="line">});</div></div><!-- fragment --><p>You can also emit the path:</p>
<div class="fragment"><div class="line">var stream = JSONStream.parse([&#39;rows&#39;, true, &#39;doc&#39;, {emitPath: true}]) //rows, ANYTHING, doc, items in docs with keys</div><div class="line"></div><div class="line">stream.on(&#39;data&#39;, function(data) {</div><div class="line">  console.log(&#39;path:&#39;, data.path);</div><div class="line">  console.log(&#39;value:&#39;, data.value);</div><div class="line">});</div></div><!-- fragment --><h3>recursive patterns (..)</h3>
<p>&lsquo;JSONStream.parse('docs..value&rsquo;)<code> (or</code>JSONStream.parse(['docs', {recurse: true}, 'value'])<code>using an array) will emit every</code>value<code>object that is a child, grand-child, etc. of the </code>docs` object. In this example, it will match exactly 5 times at various depth levels, emitting 0, 1, 2, 3 and 4 as results.</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;total&quot;: 5,</div><div class="line">  &quot;docs&quot;: [</div><div class="line">    {</div><div class="line">      &quot;key&quot;: {</div><div class="line">        &quot;value&quot;: 0,</div><div class="line">        &quot;some&quot;: &quot;property&quot;</div><div class="line">      }</div><div class="line">    },</div><div class="line">    {&quot;value&quot;: 1},</div><div class="line">    {&quot;value&quot;: 2},</div><div class="line">    {&quot;blbl&quot;: [{}, {&quot;a&quot;:0, &quot;b&quot;:1, &quot;value&quot;:3}, 10]},</div><div class="line">    {&quot;value&quot;: 4}</div><div class="line">  ]</div><div class="line">}</div></div><!-- fragment --><h2>JSONStream.parse(pattern, map)</h2>
<p>provide a function that can be used to map or filter the json output. <code>map</code> is passed the value at that node of the pattern, if <code>map</code> return non-nullish (anything but <code>null</code> or <code>undefined</code>) that value will be emitted in the stream. If it returns a nullish value, nothing will be emitted.</p>
<p><code>JSONStream</code> also emits &lsquo;'header&rsquo;<code>and</code>'footer'<code>events, the</code>'header'<code>event contains anything in the output that was before the first match, and the</code>'footer'`, is anything after the last match.</p>
<h2>JSONStream.stringify(open, sep, close)</h2>
<p>Create a writable stream.</p>
<p>you may pass in custom <code>open</code>, <code>close</code>, and <code>seperator</code> strings. But, by default, <code>JSONStream.stringify()</code> will create an array, (with default options &lsquo;open=&rsquo;[<br />
', sep='<br />
,<br />
', close='<br />
]<br />
'`)</p>
<p>If you call <code>JSONStream.stringify(false)</code> the elements will only be seperated by a newline.</p>
<p>If you only write one item this will be valid JSON.</p>
<p>If you write many items, you can use a <code>RegExp</code> to split it into valid chunks.</p>
<h2>JSONStream.stringifyObject(open, sep, close)</h2>
<p>Very much like <code>JSONStream.stringify</code>, but creates a writable stream for objects instead of arrays.</p>
<p>Accordingly, &lsquo;open=&rsquo;{<br />
', sep='<br />
,<br />
', close='<br />
}<br />
'`.</p>
<p>When you <code>.write()</code> to the stream you must supply an array with <code>[ key, data ]</code> as the first argument.</p>
<h2>unix tool</h2>
<p>query npm to see all the modules that browserify has ever depended on.</p>
<div class="fragment"><div class="line">curl https://registry.npmjs.org/browserify | JSONStream &#39;versions.*.dependencies&#39;</div></div><!-- fragment --><h2>numbers</h2>
<p>numbers will be emitted as numbers. huge numbers that cannot be represented in memory as javascript numbers will be emitted as strings. cf <a href="https://github.com/creationix/jsonparse/commit/044b268f01c4b8f97fb936fc85d3bcfba179e5bb">https://github.com/creationix/jsonparse/commit/044b268f01c4b8f97fb936fc85d3bcfba179e5bb</a> for details.</p>
<h2>Acknowlegements</h2>
<p>this module depends on <a href="https://github.com/creationix/jsonparse">https://github.com/creationix/jsonparse</a> by Tim Caswell and also thanks to Florent Jaby for teaching me about parsing with: <a href="https://github.com/Floby/node-json-streams">https://github.com/Floby/node-json-streams</a></p>
<h2>license</h2>
<p>Dual-licensed under the MIT License or the Apache License, version 2.0 </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
