<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DSMACC: rw - Now stdin and stdout are files.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DSMACC
   &#160;<span id="projectnumber">2019</span>
   </div>
   <div id="projectbrief">Changes to DSMACC for the thesis of Daniel Ellis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">rw - Now stdin and stdout are files. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>How do you read a file from stdin? If you thought,</p>
<div class="fragment"><div class="line">var contents = fs.readFileSync(&quot;/dev/stdin&quot;, &quot;utf8&quot;);</div></div><!-- fragment --><p>you’d be wrong, because <a class="el" href="classNode.html">Node</a> only reads up to the size of the file reported by fs.stat rather than reading until it receives an EOF. So, if you redirect a file to your program (<code>cat file | program</code>), you’ll only read the first 65,536 bytes of your file. Oops.</p>
<p>What about writing a file to stdout? If you thought,</p>
<div class="fragment"><div class="line">fs.writeFileSync(&quot;/dev/stdout&quot;, contents, &quot;utf8&quot;);</div></div><!-- fragment --><p>you’d also be wrong, because this tries to close stdout, so you get this error:</p>
<div class="fragment"><div class="line">Error: UNKNOWN, unknown error</div><div class="line">    at Object.fs.writeSync (fs.js:528:18)</div><div class="line">    at Object.fs.writeFileSync (fs.js:975:21)</div></div><!-- fragment --><p>(Also, this doesn’t work on Windows, because Windows doesn’t support /dev/stdout, /dev/stdin and /dev/stderr!)</p>
<p>Shucks. So what should you do?</p>
<p>You could use a different pattern for reading from stdin:</p>
<div class="fragment"><div class="line">var chunks = [];</div><div class="line"></div><div class="line">process.stdin</div><div class="line">    .on(&quot;data&quot;, function(chunk) { chunks.push(chunk); })</div><div class="line">    .on(&quot;end&quot;, function() { console.log(chunks.join(&quot;&quot;).length); })</div><div class="line">    .setEncoding(&quot;utf8&quot;);</div></div><!-- fragment --><p>But that’s a pain, since now your code has two different code paths for reading inputs depending on whether you’re reading a real file or stdin. And the code gets even more complex if you want to <a href="https://github.com/mbostock/rw/blob/master/lib/rw/read-file-sync.js">read that file synchronously</a>.</p>
<p>You could also try a different pattern for writing to stdout:</p>
<div class="fragment"><div class="line">process.stdout.write(contents);</div></div><!-- fragment --><p>Or even:</p>
<div class="fragment"><div class="line">console.log(contents);</div></div><!-- fragment --><p>But if you try to pipe your output to <code>head</code>, you’ll get this error:</p>
<div class="fragment"><div class="line">Error: write EPIPE</div><div class="line">    at errnoException (net.js:904:11)</div><div class="line">    at Object.afterWrite (net.js:720:19)</div></div><!-- fragment --><p>Huh.</p>
<p>The <b>rw</b> module fixes these problems. It provides an interface just like readFile, readFileSync, writeFile and writeFileSync, but with implementations that work the way you expect on stdin and stdout. If you use these methods on files other than /dev/stdin or /dev/stdout, they simply delegate to the fs methods, so you can trust that they behave identically to the methods you’re used to.</p>
<p>For example, now you can read stdin synchronously like so:</p>
<div class="fragment"><div class="line">var contents = rw.readFileSync(&quot;/dev/stdin&quot;, &quot;utf8&quot;);</div></div><!-- fragment --><p>Or to write to stdout:</p>
<div class="fragment"><div class="line">rw.writeFileSync(&quot;/dev/stdout&quot;, contents, &quot;utf8&quot;);</div></div><!-- fragment --><p>And rw automatically squashes EPIPE errors, so you can pipe the output of your program to <code>head</code> and you won’t get a spurious stack trace.</p>
<p>To install, <code>npm install rw</code>.</p>
<h3>Note</h3>
<p>If you want to read synchronously from stdin using <a href="#readFileSync">readFileSync</a>, you cannot also use process.stdin in the same program. Likewise, if you want to write synchronously to stdout or stderr using <a href="#writeFileSync">writeFileSync</a>, you cannot use process.stdout or process.stderr, respectively. (This includes using console.log and the like!) Failure to heed this warning may result in error: EAGAIN, resource temporarily unavailable. Unfortunately, it does not appear possible for this library to fix this issue automatically, so please use caution.</p>
<p>Only the asynchronous methods <a href="#readFile">readFile</a> and <a href="#writeFile">writeFile</a> are supported on Windows. <a class="el" href="classNode.html">Node</a> has no synchronous API for reading from process.<a href="https://nodejs.org/api/process.html#process_process_stdin">stdin</a> or writing to process.<a href="https://nodejs.org/api/process.html#process_process_stdout">stdout</a> or process.<a href="https://nodejs.org/api/process.html#process_process_stderr">stderr</a>, so you’re out of luck!</p>
<h2>API Reference</h2>
<p><a class="anchor" id="readFile"></a># rw.<b>readFile</b>(<em>path</em>[, <em>options</em>], <em>callback</em>)</p>
<p>Reads the file at the specified <em>path</em> completely into memory, invoking the specified <em>callback</em> once the data is available and the file is closed. The <em>callback</em> is invoked with two arguments: the <em>error</em> that occurred during read (hopefully null), and the read data. If <em>options</em> is a string, it specifies the encoding to use, in which case the read data will be a string; otherwise <em>options</em> is an object, and may specify encoding and flag properties. This method is a drop-in replacement for <a href="https://nodejs.org/api/fs.html#fs_fs_readfile_file_options_callback">fs.readFile</a> and fixes the behavior of special files such as /dev/stdin.</p>
<p><a class="anchor" id="readFileSync"></a># rw.<b>readFileSync</b>(<em>path</em>[, <em>options</em>])</p>
<p>Reads the file at the specified <em>path</em> completely into memory, synchronously, returning the data. If an error occurred during read, this function throws an error instead. If <em>options</em> is a string, it specifies the encoding to use, in which case the read data will be a string; otherwise <em>options</em> is an object, and may specify encoding and flag properties. This method is a drop-in replacement for <a href="https://nodejs.org/api/fs.html#fs_fs_readfilesync_file_options">fs.readFileSync</a> and fixes the behavior of special files such as /dev/stdin.</p>
<p><a class="anchor" id="writeFile"></a># rw.<b>writeFile</b>(<em>path</em>, <em>data</em>[, <em>options</em>], <em>callback</em>)</p>
<p>Writes the specified <em>data</em> (completely in memory) to a file at the specified <em>path</em>, invoking the specified <em>callback</em> once the data is completely written and the file is closed. The <em>callback</em> is invoked with a single argument: the <em>error</em> that occurred during write (hopefully null). If <em>options</em> is a string, it specifies the encoding to use, in which case the <em>data</em> must be a string; otherwise <em>options</em> is an object, and may specify encoding, mode and flag properties. This method is a drop-in replacement for <a href="https://nodejs.org/api/fs.html#fs_fs_writefile_file_data_options_callback">fs.writeFile</a> and fixes the behavior of special files such as /dev/stdout.</p>
<p><a class="anchor" id="writeFileSync"></a># rw.<b>writeFileSync</b>(<em>path</em>, <em>data</em>[, <em>options</em>])</p>
<p>Writes the specified <em>data</em> (completely in memory) to a file at the specified <em>path</em>, synchronously, returning once the data is completely written and the file is closed. Throws an <em>error</em> if one occurs during write. If <em>options</em> is a string, it specifies the encoding to use, in which case the <em>data</em> must be a string; otherwise <em>options</em> is an object, and may specify encoding, mode and flag properties. This method is a drop-in replacement for <a href="https://nodejs.org/api/fs.html#fs_fs_writefilesync_file_data_options">fs.writeFileSync</a> and fixes the behavior of special files such as /dev/stdout.</p>
<p><a class="anchor" id="dash_readFile"></a># rw.dash.<b>readFile</b>(<em>path</em>[, <em>options</em>], <em>callback</em>)</p>
<p>Equivalent to <a href="#readFile">rw.readFile</a>, except treats a <em>path</em> of <code>-</code> as <code>/dev/stdin</code>. Useful for command-line arguments.</p>
<p><a class="anchor" id="dash_readFileSync"></a># rw.dash.<b>readFileSync</b>(<em>path</em>[, <em>options</em>])</p>
<p>Equivalent to <a href="#readFileSync">rw.readFileSync</a>, except treats a <em>path</em> of <code>-</code> as <code>/dev/stdin</code>. Useful for command-line arguments.</p>
<p><a class="anchor" id="dash_writeFile"></a># rw.dash.<b>writeFile</b>(<em>path</em>, <em>data</em>[, <em>options</em>], <em>callback</em>)</p>
<p>Equivalent to <a href="#writeFile">rw.writeFile</a>, except treats a <em>path</em> of <code>-</code> as <code>/dev/stdout</code>. Useful for command-line arguments.</p>
<p><a class="anchor" id="dash_writeFileSync"></a># rw.dash.<b>writeFileSync</b>(<em>path</em>, <em>data</em>[, <em>options</em>])</p>
<p>Equivalent to <a href="#writeFileSync">rw.writeFileSync</a>, except treats a <em>path</em> of <code>-</code> as <code>/dev/stdout</code>. Useful for command-line arguments. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
