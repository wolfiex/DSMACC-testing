<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DSMACC: Node.js - klaw</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DSMACC
   &#160;<span id="projectnumber">2019</span>
   </div>
   <div id="projectbrief">Changes to DSMACC for the thesis of Daniel Ellis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Node.js - klaw </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A Node.js file system walker extracted from <a href="https://github.com/jprichardson/node-fs-extra">fs-extra</a>.</p>
<p><a href="https://www.npmjs.org/package/klaw"></a> <a href="http://travis-ci.org/jprichardson/node-klaw"></a> <a href="https://ci.appveyor.com/project/jprichardson/node-klaw/branch/master"></a></p>
<p><a href="http://standardjs.com"></a></p>
<h2>Install </h2>
<pre class="fragment">npm i --save klaw
</pre><h2>Name </h2>
<p><code>klaw</code> is <code>walk</code> backwards :p</p>
<h2>Usage </h2>
<h3>klaw(directory, [options])</h3>
<p>Returns a <a href="https://nodejs.org/api/stream.html#stream_class_stream_readable">Readable stream</a> that iterates through every file and directory starting with <code>dir</code> as the root. Every <code>read()</code> or <code>data</code> event returns an object with two properties: <code>path</code> and <code>stats</code>. <code>path</code> is the full path of the file and <code>stats</code> is an instance of <a href="https://nodejs.org/api/fs.html#fs_class_fs_stats">fs.Stats</a>.</p>
<ul>
<li><code>directory</code>: The directory to recursively walk. Type <code>string</code>.</li>
<li><code>options</code>: <a href="https://nodejs.org/api/stream.html#stream_new_stream_readable_options">Readable stream options</a> and the following:<ul>
<li><code>queueMethod</code> (<code>string</code>, default: &lsquo;'shift&rsquo;<code>): Either</code>'shift'<code>or</code>'pop'<code>. On</code>readdir()<code>array, call either</code>shift()<code>or</code>pop()<code>. -</code>pathSorter<code>(</code>function<code>, default:</code>undefined<code>): Sorting [function for Arrays](<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort">https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort</a>). -</code>fs<code>(</code>object<code>, default:</code>require('fs')<code>): Use this to hook into the</code>fs<code>methods or to use [</code>mock-fs<code>](<a href="https://github.com/tschaub/mock-fs">https://github.com/tschaub/mock-fs</a>) -</code>filter<code>(</code>function<code>, default:</code>undefined`): Filtering <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/filter">function for Arrays</a></li>
</ul>
</li>
</ul>
<p><b>Streams 1 (push) example:</b></p>
<div class="fragment"><div class="line">var klaw = require(&#39;klaw&#39;)</div><div class="line"></div><div class="line">var items = [] // files, directories, symlinks, etc</div><div class="line">klaw(&#39;/some/dir&#39;)</div><div class="line">  .on(&#39;data&#39;, function (item) {</div><div class="line">    items.push(item.path)</div><div class="line">  })</div><div class="line">  .on(&#39;end&#39;, function () {</div><div class="line">    console.dir(items) // =&gt; [ ... array of files]</div><div class="line">  })</div></div><!-- fragment --><p><b>Streams 2 &amp; 3 (pull) example:</b></p>
<div class="fragment"><div class="line">var klaw = require(&#39;klaw&#39;)</div><div class="line"></div><div class="line">var items = [] // files, directories, symlinks, etc</div><div class="line">klaw(&#39;/some/dir&#39;)</div><div class="line">  .on(&#39;readable&#39;, function () {</div><div class="line">    var item</div><div class="line">    while ((item = this.read())) {</div><div class="line">      items.push(item.path)</div><div class="line">    }</div><div class="line">  })</div><div class="line">  .on(&#39;end&#39;, function () {</div><div class="line">    console.dir(items) // =&gt; [ ... array of files]</div><div class="line">  })</div></div><!-- fragment --><p>If you're not sure of the differences on Node.js streams 1, 2, 3 then I'd recommend this resource as a good starting point: <a href="https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/">https://strongloop.com/strongblog/whats-new-io-js-beta-streams3/</a>.</p>
<h3>Error Handling</h3>
<p>Listen for the <code>error</code> event.</p>
<p>Example:</p>
<div class="fragment"><div class="line">var klaw = require(&#39;klaw&#39;)</div><div class="line">klaw(&#39;/some/dir&#39;)</div><div class="line">  .on(&#39;readable&#39;, function () {</div><div class="line">    var item</div><div class="line">    while ((item = this.read())) {</div><div class="line">      // do something with the file</div><div class="line">    }</div><div class="line">  })</div><div class="line">  .on(&#39;error&#39;, function (err, item) {</div><div class="line">    console.log(err.message)</div><div class="line">    console.log(item.path) // the file the error occurred on</div><div class="line">  })</div><div class="line">  .on(&#39;end&#39;, function () {</div><div class="line">    console.dir(items) // =&gt; [ ... array of files]</div><div class="line">  })</div></div><!-- fragment --><h3>Aggregation / Filtering / Executing Actions (Through Streams)</h3>
<p>On many occasions you may want to filter files based upon size, extension, etc. Or you may want to aggregate stats on certain file types. Or maybe you want to perform an action on certain file types.</p>
<p>You should use the module <a href="https://www.npmjs.com/package/through2"><code>through2</code></a> to easily accomplish this.</p>
<p>Install <code>through2</code>: </p><pre class="fragment">npm i --save through2
</pre><p><b>Example (skipping directories):</b></p>
<div class="fragment"><div class="line">var klaw = require(&#39;klaw&#39;)</div><div class="line">var through2 = require(&#39;through2&#39;)</div><div class="line"></div><div class="line">var excludeDirFilter = through2.obj(function (item, enc, next) {</div><div class="line">  if (!item.stats.isDirectory()) this.push(item)</div><div class="line">  next()</div><div class="line">})</div><div class="line"></div><div class="line">var items = [] // files, directories, symlinks, etc</div><div class="line">klaw(&#39;/some/dir&#39;)</div><div class="line">  .pipe(excludeDirFilter)</div><div class="line">  .on(&#39;data&#39;, function (item) {</div><div class="line">    items.push(item.path)</div><div class="line">  })</div><div class="line">  .on(&#39;end&#39;, function () {</div><div class="line">    console.dir(items) // =&gt; [ ... array of files without directories]</div><div class="line">  })</div></div><!-- fragment --><p> <b>Example (ignore hidden directories):</b> </p><div class="fragment"><div class="line">var klaw = require(&#39;klaw&#39;)</div><div class="line">var path = require(&#39;path&#39;)</div><div class="line"></div><div class="line">var filterFunc = function(item){</div><div class="line">  var basename = path.basename(item)</div><div class="line">  return basename === &#39;.&#39; || basename[0] !== &#39;.&#39;</div><div class="line">}</div><div class="line"></div><div class="line">klaw(&#39;/some/dir&#39;, { filter : filterFunc  })</div><div class="line">  .on(&#39;data&#39;, function(item){</div><div class="line">    // only items of none hidden folders will reach here</div><div class="line">  })</div></div><!-- fragment --><p><b>Example (totaling size of PNG files):</b></p>
<div class="fragment"><div class="line">var klaw = require(&#39;klaw&#39;)</div><div class="line">var path = require(&#39;path&#39;)</div><div class="line">var through2 = require(&#39;through2&#39;)</div><div class="line"></div><div class="line">var totalPngsInBytes = 0</div><div class="line">var aggregatePngSize = through2.obj(function (item, enc, next) {</div><div class="line">  if (path.extname(item.path) === &#39;.png&#39;) {</div><div class="line">    totalPngsInBytes += item.stats.size</div><div class="line">  }</div><div class="line">  this.push(item)</div><div class="line">  next()</div><div class="line">})</div><div class="line"></div><div class="line">klaw(&#39;/some/dir&#39;)</div><div class="line">  .pipe(aggregatePngSize)</div><div class="line">  .on(&#39;data&#39;, function (item) {</div><div class="line">    items.push(item.path)</div><div class="line">  })</div><div class="line">  .on(&#39;end&#39;, function () {</div><div class="line">    console.dir(totalPngsInBytes) // =&gt; total of all pngs (bytes)</div><div class="line">  })</div></div><!-- fragment --><p><b>Example (deleting all .tmp files):</b></p>
<div class="fragment"><div class="line">var fs = require(&#39;fs&#39;)</div><div class="line">var klaw = require(&#39;klaw&#39;)</div><div class="line">var through2 = require(&#39;through2&#39;)</div><div class="line"></div><div class="line">var deleteAction = through2.obj(function (item, enc, next) {</div><div class="line">  this.push(item)</div><div class="line"></div><div class="line">  if (path.extname(item.path) === &#39;.tmp&#39;) {</div><div class="line">    item.deleted = true</div><div class="line">    fs.unklink(item.path, next)</div><div class="line">  } else {</div><div class="line">    item.deleted = false</div><div class="line">    next()</div><div class="line">  }  </div><div class="line">})</div><div class="line"></div><div class="line">var deletedFiles = []</div><div class="line">klaw(&#39;/some/dir&#39;)</div><div class="line">  .pipe(deleteAction)</div><div class="line">  .on(&#39;data&#39;, function (item) {</div><div class="line">    if (!item.deleted) return</div><div class="line">    deletedFiles.push(item.path)</div><div class="line">  })</div><div class="line">  .on(&#39;end&#39;, function () {</div><div class="line">    console.dir(deletedFiles) // =&gt; all deleted files</div><div class="line">  })</div></div><!-- fragment --><p>You can even chain a bunch of these filters and aggregators together. By using multiple pipes.</p>
<p><b>Example (using multiple filters / aggregators):</b></p>
<div class="fragment"><div class="line">klaw(&#39;/some/dir&#39;)</div><div class="line">  .pipe(filterCertainFiles)</div><div class="line">  .pipe(deleteSomeOtherFiles)</div><div class="line">  .on(&#39;end&#39;, function () {</div><div class="line">    console.log(&#39;all done!&#39;)</div><div class="line">  })</div></div><!-- fragment --><p><b>Example passing (piping) through errors:</b></p>
<p>Node.js does not <code>pipe()</code> errors. This means that the error on one stream, like <code>klaw</code> will not pipe through to the next. If you want to do this, do the following:</p>
<div class="fragment"><div class="line">var klaw = require(&#39;klaw&#39;)</div><div class="line">var through2 = require(&#39;through2&#39;)</div><div class="line"></div><div class="line">var excludeDirFilter = through2.obj(function (item, enc, next) {</div><div class="line">  if (!item.stats.isDirectory()) this.push(item)</div><div class="line">  next()</div><div class="line">})</div><div class="line"></div><div class="line">var items = [] // files, directories, symlinks, etc</div><div class="line">klaw(&#39;/some/dir&#39;)</div><div class="line">  .on(&#39;error&#39;, function (err) { excludeDirFilter.emit(&#39;error&#39;, err) }) // forward the error on</div><div class="line">  .pipe(excludeDirFilter)</div><div class="line">  .on(&#39;data&#39;, function (item) {</div><div class="line">    items.push(item.path)</div><div class="line">  })</div><div class="line">  .on(&#39;end&#39;, function () {</div><div class="line">    console.dir(items) // =&gt; [ ... array of files without directories]</div><div class="line">  })</div></div><!-- fragment --><h3>Searching Strategy</h3>
<p>Pass in options for <code>queueMethod</code> and <code>pathSorter</code> to affect how the file system is recursively iterated. See the code for more details, it's less than 50 lines :)</p>
<h2>License </h2>
<p>MIT</p>
<p>Copyright (c) 2015 <a href="https://github.com/jprichardson">JP Richardson</a> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
