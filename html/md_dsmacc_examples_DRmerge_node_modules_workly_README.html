<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DSMACC: Workly    üèãÔ∏è‚Äç‚ôÄÔ∏è‚Üí üòÑ</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DSMACC
   &#160;<span id="projectnumber">2019</span>
   </div>
   <div id="projectbrief">Changes to DSMACC for the thesis of Daniel Ellis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Workly üèãÔ∏è‚Äç‚ôÄÔ∏è‚Üí üòÑ </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><ul>
<li>A really simple way to move a stand-alone <b>function/class to a worker thread</b>.</li>
<li>Or, <b>expose an object or function in a worker</b> to the main thread.</li>
<li>All calls are made asynchronous. Works great with async/await.</li>
<li>Only 1kB gzipped.</li>
</ul>
<h2>Install</h2>
<p>Download the latest from <a href="https://github.com/pshihn/workly/tree/master/dist">dist folder</a></p>
<p>or from npm: </p><div class="fragment"><div class="line">npm install --save workly</div></div><!-- fragment --><h2>Usage</h2>
<p>Moving a function to a worker is really simple. </p><div class="fragment"><div class="line">function busyAdd(a, b) {</div><div class="line">  let st = Date.now();</div><div class="line">  while (true) {</div><div class="line">    if ((Date.now() - st) &gt; 2000) break;</div><div class="line">  }</div><div class="line">  return a + b;</div><div class="line">}</div><div class="line"></div><div class="line">(async () =&gt; {</div><div class="line">  let workerAdd = workly.proxy(busyAdd);</div><div class="line">  console.log(await workerAdd(23, 16)); // 39</div><div class="line">  // the busyAdd is executed in a worker so</div><div class="line">  // the UI does not get blocked</div><div class="line">})();</div></div><!-- fragment --><p>Or, in fact a Class</p>
<div class="fragment"><div class="line">class Adder {</div><div class="line">  constructor() {</div><div class="line">    this.count = 0;</div><div class="line">  }</div><div class="line">  add(a, b) {</div><div class="line">    this.count++;</div><div class="line">    return a + b;</div><div class="line">  }</div><div class="line">}</div><div class="line"></div><div class="line">(async () =&gt; {</div><div class="line">  let WAdder = workly.proxy(Adder);</div><div class="line">  let a = await new WAdder(); // instance created/running in worker</div><div class="line">  console.log(await a.count); // 0</div><div class="line">  console.log(await a.add(23, 16)); // 39</div><div class="line">  console.log(await a.count); // 1</div><div class="line">})();</div></div><!-- fragment --><h3>Custom workers</h3>
<p>The above examples only work when the class/function is not dependent on the containing scope, i.e. other libraries or global objects. But, you can create a custom worker.js file and move the code in there. In the worker, you can expose your object/function/class using <em>workly.expose</em> method.</p>
<p>In this example, the function depends on moment.js</p>
<p><b>worker.js</b> </p><div class="fragment"><div class="line">importScripts(&#39;https://cdn.jsdelivr.net/npm/moment@2.20.1/moment.min.js&#39;, &#39;../dist/workly.js&#39;);</div><div class="line">function friendlyTime(value) {</div><div class="line">  return moment(value).calendar(null, {</div><div class="line">    sameDay: function (now) {</div><div class="line">      if (now - this &lt; 1000 * 60) {</div><div class="line">        return &quot;[Just now]&quot;;</div><div class="line">      } else if (now - this &lt; 1000 * 60 * 60) {</div><div class="line">        return &quot;[&quot; + Math.round((now - this) / (1000 * 60)) + &quot; mins ago]&quot;;</div><div class="line">      } else {</div><div class="line">        return &#39;[Today at] LT&#39;</div><div class="line">      }</div><div class="line">    }</div><div class="line">  });</div><div class="line">}</div><div class="line">workly.expose(friendlyTime);</div></div><!-- fragment --><p> <b>main.js</b> </p><div class="fragment"><div class="line">(async () =&gt; {</div><div class="line">  let w = workly.proxy(&quot;./worker.js&quot;);</div><div class="line">  let now = Date.now();</div><div class="line">  console.log(now);</div><div class="line">  console.log(await w(now));</div><div class="line">  console.log(await w(now - (24 * 60 * 60 * 1000)));</div><div class="line">  console.log(await w(now - (4 * 24 * 60 * 60 * 1000)));</div><div class="line">})();</div></div><!-- fragment --><h3>Caveats</h3>
<ul>
<li>If you're not using a custom worker, the function/class being pushed to the worker cannot depend on the containing scope.</li>
<li>Since workers do not have access to DOM, DOM manipulation is not supported.</li>
<li>Objects passed into functions are not passed by reference, so if the function in the worker updates the passed in object, it will not affect the object in the main scope.</li>
</ul>
<h3>Examples</h3>
<p>See the <a href="https://github.com/pshihn/workly/tree/master/examples">examples folder</a></p>
<h3>License</h3>
<p><a href="https://github.com/pshihn/workly/blob/master/LICENSE">MIT License</a> (c) <a href="https://twitter.com/preetster">Preet Shihn</a></p>
<h3>You may also be interested in</h3>
<p><a href="https://github.com/pshihn/windtalk">windtalk</a> - Simplest way to communicate between windows or iframes. Work with objects/functions defined in another window or iframe. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
