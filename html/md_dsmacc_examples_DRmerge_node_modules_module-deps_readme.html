<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>DSMACC: module-deps</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">DSMACC
   &#160;<span id="projectnumber">2019</span>
   </div>
   <div id="projectbrief">Changes to DSMACC for the thesis of Daniel Ellis</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">module-deps </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>walk the dependency graph to generate json output that can be fed into <a href="https://github.com/browserify/browser-pack">browser-pack</a></p>
<p><a href="http://travis-ci.org/browserify/module-deps"></a></p>
<h1>example</h1>
<div class="fragment"><div class="line">var mdeps = require(&#39;module-deps&#39;);</div><div class="line">var JSONStream = require(&#39;JSONStream&#39;);</div><div class="line"></div><div class="line">var md = mdeps();</div><div class="line">md.pipe(JSONStream.stringify()).pipe(process.stdout);</div><div class="line">md.end({ file: __dirname + &#39;/files/main.js&#39; });</div></div><!-- fragment --><p>output:</p>
<div class="fragment"><div class="line">$ node example/deps.js</div><div class="line">[</div><div class="line">{&quot;id&quot;:&quot;/home/substack/projects/module-deps/example/files/main.js&quot;,&quot;source&quot;:&quot;var foo = require(&#39;./foo&#39;);\nconsole.log(&#39;main: &#39; + foo(5));\n&quot;,&quot;entry&quot;:true,&quot;deps&quot;:{&quot;./foo&quot;:&quot;/home/substack/projects/module-deps/example/files/foo.js&quot;}}</div><div class="line">,</div><div class="line">{&quot;id&quot;:&quot;/home/substack/projects/module-deps/example/files/foo.js&quot;,&quot;source&quot;:&quot;var bar = require(&#39;./bar&#39;);\n\nmodule.exports = function (n) {\n    return n * 111 + bar(n);\n};\n&quot;,&quot;deps&quot;:{&quot;./bar&quot;:&quot;/home/substack/projects/module-deps/example/files/bar.js&quot;}}</div><div class="line">,</div><div class="line">{&quot;id&quot;:&quot;/home/substack/projects/module-deps/example/files/bar.js&quot;,&quot;source&quot;:&quot;module.exports = function (n) {\n    return n * 100;\n};\n&quot;,&quot;deps&quot;:{}}</div><div class="line">]</div></div><!-- fragment --><p>and you can feed this json data into <a href="https://github.com/browserify/browser-pack">browser-pack</a>:</p>
<div class="fragment"><div class="line">$ node example/deps.js | browser-pack | node</div><div class="line">main: 1055</div></div><!-- fragment --><h1>usage</h1>
<div class="fragment"><div class="line">usage: module-deps [files]</div><div class="line"></div><div class="line">  generate json output from each entry file</div></div><!-- fragment --><h1>methods</h1>
<div class="fragment"><div class="line">var mdeps = require(&#39;module-deps&#39;)</div></div><!-- fragment --><h2>var d = mdeps(opts={})</h2>
<p>Return an object transform stream <code>d</code> that expects entry filenames or <code>{ id: ..., file: ... }</code> objects as input and produces objects for every dependency from a recursive module traversal as output.</p>
<p>Each file in <code>files</code> can be a string filename or a stream.</p>
<p>Optionally pass in some <code>opts</code>:</p>
<ul>
<li><code>opts.transform</code> - a string or array of string transforms (see below)</li>
<li><code>opts.transformKey</code> - an array path of strings showing where to look in the package.json for source transformations. If falsy, don't look at the package.json at all.</li>
<li><code>opts.resolve</code> - custom resolve function using the <code>opts.resolve(id, parent, cb)</code> signature that <a href="https://github.com/shtylman/node-browser-resolve">browser-resolve</a> has</li>
<li><code>opts.detect</code> - a custom dependency detection function. <code>opts.detect(source)</code> should return an array of dependency module names. By default <a href="https://github.com/browserify/detective">detective</a> is used.</li>
<li><code>opts.filter</code> - a function (id) to skip resolution of some module <code>id</code> strings. If defined, <code>opts.filter(id)</code> should return truthy for all the ids to include and falsey for all the ids to skip.</li>
<li><code>opts.postFilter</code> - a function (id, file, pkg) that gets called after <code>id</code> has been resolved. Return false to skip this file.</li>
<li><code>opts.packageFilter</code> - transform the parsed package.json contents before using the values. <code>opts.packageFilter(pkg, dir)</code> should return the new <code>pkg</code> object to use.</li>
<li><code>opts.noParse</code> - an array of absolute paths to not parse for dependencies. Use this for large dependencies like jquery or threejs which take forever to parse.</li>
<li><code>opts.cache</code> - an object mapping filenames to file objects to skip costly io</li>
<li><code>opts.packageCache</code> - an object mapping filenames to their parent package.json contents for browser fields, main entries, and transforms</li>
<li><code>opts.fileCache</code> - an object mapping filenames to raw source to avoid reading from disk.</li>
<li><p class="startli"><code>opts.persistentCache</code> - a complex cache handler that allows async and persistent caching of data. A <code>persistentCache</code> needs to follow this interface: ```js function persistentCache ( file, // the path to the file that is loaded id, // the id that is used to reference this file pkg, // the package that this file belongs to fallback fallback, // async fallback handler to be called if the cache doesn't hold the given file cb // callback handler that receives the cache data ) { if (hasError()) { return cb(error) // Pass any error to the callback }</p>
<p class="startli">var fileData = fs.readFileSync(file) var key = keyFromFile(file, fileData)</p>
<p class="startli">if (db.has(key)) { return cb(null, { source: db.get(key).toString(), package: pkg, // The package for housekeeping deps: { 'id': // id that is used to reference a required file 'file' // file path to the required file } }) } // // The fallback will process the file in case the file is not // in cache. // // Note that if your implementation doesn't need the file data // then you can pass <code>null</code> instead of the source and the fallback will // fetch the data by itself. // fallback(fileData, function (error, cacheableEntry) { if (error) { return cb(error) } db.addToCache(key, cacheableEntry) cb(null, cacheableEntry) }) } ```</p>
</li>
<li><code>opts.paths</code> - array of global paths to search. Defaults to splitting on &lsquo;&rsquo;:'<code> in</code>process.env.NODE_PATH`</li>
<li><code>opts.ignoreMissing</code> - ignore files that failed to resolve</li>
</ul>
<h1>input objects</h1>
<p>Input objects should be string filenames or objects with these parameters:</p>
<ul>
<li><code>row.file</code> - filename</li>
<li><code>row.entry</code> - whether to treat this file as an entry point, defaults to <code>true</code>. Set to <code>false</code> to include this file, but not run it automatically.</li>
<li><code>row.expose</code> - name to be exposed as</li>
<li><code>row.noparse</code> - when true, don't parse the file contents for dependencies</li>
</ul>
<p>or objects can specify transforms:</p>
<ul>
<li><code>row.transform</code> - string name, path, or function</li>
<li><code>row.options</code> - transform options as an object</li>
<li><code>row.global</code> - boolean, whether the transform is global</li>
</ul>
<h1>output objects</h1>
<p>Output objects describe files with dependencies. They have these properties:</p>
<ul>
<li><code>row.id</code> - an identifier for the file, used in the <code>row.deps</code> prperty</li>
<li><code>row.file</code> - path to the source file</li>
<li><code>row.entry</code> - true if the file is an entry point</li>
<li><code>row.expose</code> - name to be exposed as</li>
<li><code>row.source</code> - source file content as a string</li>
<li><code>row.deps</code> - object describing dependencies. The keys are strings as used in <code>require()</code> calls in the file, and values are the row IDs (file paths) of dependencies.</li>
</ul>
<h1>events</h1>
<h2>d.on('transform', function (tr, file) {})</h2>
<p>Every time a transform is applied to a <code>file</code>, a &lsquo;'transform&rsquo;<code>event fires with the instantiated transform stream</code>tr`.</p>
<h2>d.on('file', function (file) {})</h2>
<p>Every time a file is read, this event fires with the file path.</p>
<h2>d.on('missing', function (id, parent) {})</h2>
<p>When <code>opts.ignoreMissing</code> is enabled, this event fires for each missing package.</p>
<h2>d.on('package', function (pkg) {})</h2>
<p>Every time a package is read, this event fires. The directory name of the package is available in <code>pkg.__dirname</code>.</p>
<h1>transforms</h1>
<p>module-deps can be configured to run source transformations on files before parsing them for <code>require()</code> calls. These transforms are useful if you want to compile a language like <a href="http://coffeescript.org/">coffeescript</a> on the fly or if you want to load static assets into your bundle by parsing the AST for <code>fs.readFileSync()</code> calls.</p>
<p>If the transform is a function, it should take the <code>file</code> name as an argument and return a through stream that will be written file contents and should output the new transformed file contents.</p>
<p>If the transform is a string, it is treated as a module name that will resolve to a module that is expected to follow this format:</p>
<div class="fragment"><div class="line">var through = require(&#39;through2&#39;);</div><div class="line">module.exports = function (file, opts) { return through() };</div></div><!-- fragment --><p>You don't necessarily need to use the <a href="https://github.com/rvagg/through2">through2</a> module to create a readable/writable filter stream for transforming file contents, but this is an easy way to do it.</p>
<p>module-deps looks for <code>require()</code> calls and adds their arguments as dependencies of a file. Transform streams can emit &lsquo;'dep&rsquo;<code>events to include additional dependencies that are not consumed with</code>require()`.</p>
<p>When you call <code>mdeps()</code> with an <code>opts.transform</code>, the transformations you specify will not be run for any files in node_modules/. This is because modules you include should be self-contained and not need to worry about guarding themselves against transformations that may happen upstream.</p>
<p>Modules can apply their own transformations by setting a transformation pipeline in their package.json at the <code>opts.transformKey</code> path. These transformations only apply to the files directly in the module itself, not to the module's dependants nor to its dependencies.</p>
<h2>package.json transformKey</h2>
<p>Transform keys live at a configurable location in the package.json denoted by the <code>opts.transformKey</code> array.</p>
<p>For a transformKey of &lsquo;['foo&rsquo;,'bar']<code>, the transformKey can be a single string (</code>"fff"`):</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;foo&quot;: {</div><div class="line">    &quot;bar&quot;: &quot;fff&quot;</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>or an array of strings (<code>["fff","ggg"]</code>):</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;foo&quot;: {</div><div class="line">    &quot;bar&quot;: [&quot;fff&quot;,&quot;ggg&quot;]</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>If you want to pass options to the transforms, you can use a 2-element array inside of the primary array. Here <code>fff</code> gets an options object with <code>{"x":3}</code> and <code>ggg</code> gets <code>{"y":4}</code>:</p>
<div class="fragment"><div class="line">{</div><div class="line">  &quot;foo&quot;: {</div><div class="line">    &quot;bar&quot;: [[&quot;fff&quot;,{&quot;x&quot;:3}],[&quot;ggg&quot;,{&quot;y&quot;:4}]]</div><div class="line">  }</div><div class="line">}</div></div><!-- fragment --><p>Options sent to the module-deps constructor are also provided under <code>opts._flags</code>. These options are sometimes required if your transform needs to do something different when browserify is run in debug mode, for example.</p>
<h1>usage</h1>
<div class="fragment"><div class="line">module-deps [FILES] OPTIONS</div><div class="line"></div><div class="line">  Generate json output for the entry point FILES.</div><div class="line"></div><div class="line">OPTIONS are:</div><div class="line"></div><div class="line">  -t TRANSFORM  Apply a TRANSFORM.</div><div class="line">  -g TRANSFORM  Apply a global TRANSFORM.</div></div><!-- fragment --><h1>install</h1>
<p>With <a href="http://npmjs.org">npm</a>, to get the module do:</p>
<div class="fragment"><div class="line">npm install module-deps</div></div><!-- fragment --><p>and to get the <code>module-deps</code> command do:</p>
<div class="fragment"><div class="line">npm install -g module-deps</div></div><!-- fragment --><h1>license</h1>
<p>MIT </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
